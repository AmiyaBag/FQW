{"ast":null,"code":"var _jsxFileName = \"D:\\\\Amina\\\\VScode\\\\FQW_new\\\\src\\\\components\\\\DocumentAnalysis.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport Modal from 'react-modal';\nimport { Chart as ChartJS, CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend } from 'chart.js';\nimport { Bar } from 'react-chartjs-2';\nimport './DocumentAnalysis.css'; // Make sure this CSS file exists and is styled appropriately\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst apiUrl = process.env.REACT_APP_API_URL;\n\n// Set the app element for react-modal accessibility\nModal.setAppElement('#root'); // Adjust '#root' if your app's root element has a different ID\n\n// Register Chart.js components\nChartJS.register(CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend);\nfunction DocumentAnalysis() {\n  _s();\n  // State Variables\n  const [documents, setDocuments] = useState([]);\n  const [workers, setWorkers] = useState([]);\n  const [selectedWorker, setSelectedWorker] = useState(null); // Store worker ID\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [viewMode, setViewMode] = useState('analysis'); // 'analysis' or 'documents'\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [selectedDocumentForModal, setSelectedDocumentForModal] = useState(null);\n  const [sortConfig, setSortConfig] = useState({\n    key: 'DateIssue',\n    direction: 'descending'\n  }); // Added sort state\n\n  // Hooks\n  const navigate = useNavigate();\n  const user = JSON.parse(localStorage.getItem('user')); // Assuming user info is stored here\n\n  // Sort function\n  const requestSort = key => {\n    let direction = 'ascending';\n    if (sortConfig.key === key && sortConfig.direction === 'ascending') {\n      direction = 'descending';\n    }\n    setSortConfig({\n      key,\n      direction\n    });\n  };\n\n  // Helper function to sort documents\n  const sortDocuments = (docs, config) => {\n    if (!config.key) return docs;\n    return [...docs].sort((a, b) => {\n      // Handle date fields specially\n      if (['DateIssue', 'DataStart', 'DataEnd'].includes(config.key)) {\n        const dateA = a[config.key] ? new Date(a[config.key]).getTime() : 0;\n        const dateB = b[config.key] ? new Date(b[config.key]).getTime() : 0;\n        if (dateA < dateB) {\n          return config.direction === 'ascending' ? -1 : 1;\n        }\n        if (dateA > dateB) {\n          return config.direction === 'ascending' ? 1 : -1;\n        }\n        return 0;\n      }\n\n      // Handle numeric fields\n      if (['ID_Document', 'ID_Worker', 'ID_ProgDPO'].includes(config.key)) {\n        const valA = a[config.key] || 0;\n        const valB = b[config.key] || 0;\n        return config.direction === 'ascending' ? valA - valB : valB - valA;\n      }\n\n      // Handle string fields\n      const valA = String(a[config.key] || '').toLowerCase();\n      const valB = String(b[config.key] || '').toLowerCase();\n      if (valA < valB) {\n        return config.direction === 'ascending' ? -1 : 1;\n      }\n      if (valA > valB) {\n        return config.direction === 'ascending' ? 1 : -1;\n      }\n      return 0;\n    });\n  };\n\n  // Render sortable header\n  const renderSortableHeader = (label, key) => /*#__PURE__*/_jsxDEV(\"th\", {\n    onClick: () => requestSort(key),\n    className: \"sortable-header\",\n    style: {\n      cursor: 'pointer'\n    },\n    children: [label, sortConfig.key === key ? sortConfig.direction === 'ascending' ? ' ▲' : ' ▼' : ' ↕']\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 9\n  }, this);\n\n  // --- Helper Function: Get Worker Name (Memoized) ---\n  const getWorkerName = useCallback(() => {\n    // Ensure workers is an array before using find\n    if ((user === null || user === void 0 ? void 0 : user.role) !== 1 || !selectedWorker || !Array.isArray(workers)) return '';\n    const worker = workers.find(w => w.ID_Worker === selectedWorker);\n    return worker ? worker.FName_Worker : `ID ${selectedWorker}`; // Use FName_Worker or adjust as needed\n  }, [user === null || user === void 0 ? void 0 : user.role, selectedWorker, workers]); // Dependencies for getWorkerName\n\n  // --- useEffect for Data Fetching ---\n  useEffect(() => {\n    const fetchData = async () => {\n      setLoading(true);\n      setError('');\n      try {\n        // Fetch documents based on user ID and role\n        const documentsResponse = await axios.get(`${apiUrl}/api/documents`, {\n          params: {\n            userId: user.workerId,\n            role: user.role\n          }\n        });\n\n        // Validate documents response\n        if (!Array.isArray(documentsResponse.data)) {\n          console.error('Documents API did not return an array:', documentsResponse.data);\n          throw new Error('Неверный формат данных документов');\n        }\n        setDocuments(documentsResponse.data);\n        console.log(\"Frontend: Documents received:\", documentsResponse.data.length);\n        if (documentsResponse.data.length > 0) {\n          var _documentsResponse$da;\n          // Log the structure of KKS_Data for the first doc for verification\n          console.log(\"Frontend: Sample KKS_Data in first doc:\", (_documentsResponse$da = documentsResponse.data[0]) === null || _documentsResponse$da === void 0 ? void 0 : _documentsResponse$da.KKS_Data);\n        }\n\n        // Fetch workers list if the user is an admin (role === 1)\n        if (user.role === 1) {\n          const workersResponse = await axios.get(`${apiUrl}/api/workers`);\n\n          // Validate workers response\n          if (!Array.isArray(workersResponse.data)) {\n            console.error(\"Workers API did not return an array:\", workersResponse.data);\n            setWorkers([]); // Set empty array on error\n          } else {\n            setWorkers(workersResponse.data);\n            // Set the initial selected worker ONLY if workers exist and NO worker is currently selected\n            // This prevents resetting selection if the component re-renders for other reasons\n            if (workersResponse.data.length > 0 && selectedWorker === null) {\n              setSelectedWorker(workersResponse.data[0].ID_Worker);\n            } else if (workersResponse.data.length === 0) {\n              setSelectedWorker(null); // No workers available\n            }\n          }\n        } else {\n          // Not an admin, clear workers and selection\n          setWorkers([]);\n          setSelectedWorker(null);\n        }\n      } catch (err) {\n        var _err$response, _err$response$data;\n        console.error('Ошибка при загрузке данных:', err);\n        setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.error) || err.message || 'Не удалось загрузить данные');\n      } finally {\n        setLoading(false);\n      }\n    };\n    if (user !== null && user !== void 0 && user.workerId) {\n      fetchData();\n    } else {\n      setError(\"Пользователь не найден. Пожалуйста, войдите снова.\");\n      setLoading(false);\n      // Optional: Redirect to login\n      // navigate('/login');\n    }\n    // Dependency array includes user info and selectedWorker (to potentially refetch if admin changes worker, though filtering handles display)\n    // Note: Adding selectedWorker here caused a re-fetch loop in v1 - be careful. Let's keep it based on user info for initial load.\n    // Re-filtering happens via useMemo when selectedWorker changes.\n  }, [user === null || user === void 0 ? void 0 : user.workerId, user === null || user === void 0 ? void 0 : user.role]); // Re-run effect if user ID or role changes\n\n  // --- Event Handlers ---\n  const handleLogout = () => {\n    localStorage.removeItem('user');\n    navigate('/login');\n  };\n  const handleBack = () => {\n    // Navigate back based on user role\n    navigate((user === null || user === void 0 ? void 0 : user.role) === 1 ? '/admin' : '/user'); // Navigate to admin or user dashboard\n  };\n  const handleWorkerChange = event => {\n    const workerIdValue = event.target.value;\n    // Parse to integer, handle potential empty string value from a \"--Select--\" option\n    const workerId = workerIdValue ? parseInt(workerIdValue, 10) : null;\n    setSelectedWorker(workerId);\n  };\n  const handleViewModeChange = mode => {\n    setViewMode(mode);\n  };\n\n  // --- Modal Handlers ---\n  const openModal = doc => {\n    console.log(\"Opening modal for doc:\", doc);\n    setSelectedDocumentForModal(doc);\n    setIsModalOpen(true);\n  };\n  const closeModal = () => {\n    setIsModalOpen(false);\n    setSelectedDocumentForModal(null); // Clear selected doc when closing\n  };\n\n  // --- Filtered Documents (Memoized) ---\n  const filteredDocuments = useMemo(() => {\n    if (loading || !Array.isArray(documents)) return [];\n    let filtered = documents;\n    if ((user === null || user === void 0 ? void 0 : user.role) === 1) {\n      filtered = selectedWorker !== null ? documents.filter(doc => doc.ID_Worker === selectedWorker) : [];\n    }\n    return sortDocuments(filtered, sortConfig);\n  }, [documents, selectedWorker, user === null || user === void 0 ? void 0 : user.role, loading, sortConfig]);\n\n  // --- Chart Data Preparation Functions (Memoized with useCallback) ---\n\n  // 1. Yearly & Cumulative Chart Data\n  const prepareYearlyChartData = useCallback(docs => {\n    const documentsByYear = docs.reduce((acc, doc) => {\n      try {\n        // Ensure DateIssue exists and is a valid date string\n        if (doc.DateIssue) {\n          const date = new Date(doc.DateIssue);\n          if (!isNaN(date.getTime())) {\n            // Check if date is valid\n            const year = date.getFullYear();\n            acc[year] = (acc[year] || 0) + 1;\n          } else {\n            console.warn(\"Invalid DateIssue format:\", doc.ID_Document, doc.DateIssue);\n          }\n        } else {\n          console.warn(\"Missing DateIssue:\", doc.ID_Document);\n        }\n      } catch (e) {\n        console.error(\"Error parsing DateIssue:\", doc.ID_Document, doc.DateIssue, e);\n      }\n      return acc;\n    }, {});\n    const yearsInData = Object.keys(documentsByYear).map(Number).sort((a, b) => a - b);\n    const currentYear = new Date().getFullYear();\n    const minDataYear = yearsInData.length > 0 ? Math.min(...yearsInData) : currentYear;\n    const maxDataYear = yearsInData.length > 0 ? Math.max(...yearsInData) : currentYear;\n\n    // Determine the range of years for the chart (from earliest data year to at least the current year)\n    const startYear = minDataYear;\n    const endYear = Math.max(maxDataYear, currentYear);\n    const allYears = [];\n    // Populate all years in the range\n    if (startYear <= endYear) {\n      for (let year = startYear; year <= endYear; year++) {\n        allYears.push(year);\n      }\n    } else if (docs.length === 0) {// Handle case with no documents - maybe show current year?\n      // Optionally add current year: allYears.push(currentYear);\n    }\n\n    // Map counts for each year in the final range\n    const counts = allYears.map(year => documentsByYear[year] || 0);\n\n    // Calculate cumulative counts\n    const cumulativeCounts = counts.reduce((acc, count, index) => {\n      acc.push(index === 0 ? count : (acc[index - 1] || 0) + count);\n      return acc;\n    }, []);\n    return {\n      years: allYears,\n      counts,\n      cumulativeCounts\n    };\n  }, []); // useCallback as the function definition itself doesn't depend on props/state\n\n  // 2. KKS Criteria Chart Data (Processing KKS_Data array)\n  const prepareKKSChartData = useCallback(docs => {\n    // Aggregate counts per KKS criterion (using shortName as key)\n    const kksAggregated = docs.reduce((acc, doc) => {\n      const kksItems = doc.KKS_Data; // Expecting an array like [{ shortName: '..', fullName: '..' }, ...]\n\n      // Check if kksItems is a valid array\n      if (Array.isArray(kksItems)) {\n        kksItems.forEach(item => {\n          var _item$shortName, _item$fullName;\n          const shortName = item === null || item === void 0 ? void 0 : (_item$shortName = item.shortName) === null || _item$shortName === void 0 ? void 0 : _item$shortName.trim(); // Use optional chaining and trim\n          const fullName = item === null || item === void 0 ? void 0 : (_item$fullName = item.fullName) === null || _item$fullName === void 0 ? void 0 : _item$fullName.trim();\n          if (shortName) {\n            // Process only if shortName exists\n            if (!acc[shortName]) {\n              // Initialize entry for this shortName if it's the first time seen\n              acc[shortName] = {\n                shortName: shortName,\n                fullName: fullName || shortName,\n                // Use shortName as fallback if fullName is missing\n                count: 0\n              };\n            }\n            // Increment the count for this KKS criterion\n            acc[shortName].count += 1;\n          } else {\n            console.warn(\"KKS item missing shortName in doc:\", doc.ID_Document, item);\n          }\n        });\n      } else if (kksItems) {\n        // Log if KKS_Data exists but isn't an array (should be handled by backend ideally)\n        console.error(\"KKS_Data is not an array for doc:\", doc.ID_Document, kksItems);\n      }\n      // If KKS_Data is null/undefined or invalid, just skip and continue\n\n      return acc;\n    }, {}); // Initial value is an empty object\n\n    // Sort aggregated data by shortName for consistent chart axis order\n    const sortedShortNames = Object.keys(kksAggregated).sort((a, b) => a.localeCompare(b));\n\n    // Extract data arrays needed for Chart.js\n    const labels = sortedShortNames; // X-axis labels will be the Short Names\n    const fullNames = sortedShortNames.map(key => kksAggregated[key].fullName); // Full Names for tooltips\n    const counts = sortedShortNames.map(key => kksAggregated[key].count); // Bar heights\n\n    console.log(\"Prepared KKS Chart Data:\", {\n      labels,\n      fullNames,\n      counts\n    }); // Log for debugging\n\n    return {\n      labels: labels,\n      // Short names for axis\n      fullNames: fullNames,\n      // Full names for tooltips\n      counts: counts // Counts for bar heights\n    };\n  }, []); // useCallback as the function definition is stable\n\n  // --- Memoized Chart Results ---\n  // These recalculate only when filteredDocuments or the prep function changes (which it won't due to useCallback)\n  const yearlyChartResult = useMemo(() => prepareYearlyChartData(filteredDocuments), [filteredDocuments, prepareYearlyChartData]);\n  const kksChartResult = useMemo(() => prepareKKSChartData(filteredDocuments), [filteredDocuments, prepareKKSChartData]);\n\n  // --- Расчет коэффициента K ---\n  const calculateK = useCallback(cumulativeCounts => {\n    if (!Array.isArray(cumulativeCounts) || cumulativeCounts.length < 2) return 0;\n    let K = 0;\n    for (let i = 1; i < cumulativeCounts.length; i++) {\n      const diff = cumulativeCounts[i] - cumulativeCounts[i - 1];\n      if (diff > 0) {\n        K += diff;\n      }\n    }\n    return K;\n  }, []);\n  const kCoefficient = useMemo(() => {\n    return calculateK(yearlyChartResult.cumulativeCounts);\n  }, [yearlyChartResult.cumulativeCounts, calculateK]);\n\n  // --- Memoized Chart Data Objects (for react-chartjs-2) ---\n  const yearlyData = useMemo(() => ({\n    labels: yearlyChartResult.years,\n    datasets: [{\n      label: user.role === 1 ? `Документы по годам` : 'Документы по годам',\n      data: yearlyChartResult.counts,\n      backgroundColor: 'rgba(54, 162, 235, 0.6)',\n      // Blue\n      borderColor: 'rgba(54, 162, 235, 1)',\n      borderWidth: 1\n    }]\n  }), [yearlyChartResult, user.role, getWorkerName]); // Update when results or worker name changes\n\n  const cumulativeData = useMemo(() => ({\n    labels: yearlyChartResult.years,\n    datasets: [{\n      label: user.role === 1 ? `Документы по годам с приращением` : 'Документы по годам с приращением',\n      data: yearlyChartResult.cumulativeCounts,\n      backgroundColor: 'rgba(75, 192, 192, 0.6)',\n      // Teal\n      borderColor: 'rgba(75, 192, 192, 1)',\n      borderWidth: 1\n    }]\n  }), [yearlyChartResult, user.role, getWorkerName]); // Update when results or worker name changes\n\n  const kksData = useMemo(() => ({\n    labels: kksChartResult.labels,\n    // Use SHORT names for axis labels\n    datasets: [{\n      label: user.role === 1 ? `Документы по критериям ККС` : 'Документы по критериям ККС',\n      data: kksChartResult.counts,\n      backgroundColor: 'rgba(255, 159, 64, 0.6)',\n      // Orange\n      borderColor: 'rgba(255, 159, 64, 1)',\n      borderWidth: 1\n    }]\n  }), [kksChartResult, user.role, getWorkerName]); // Update when KKS results or worker name changes\n\n  // --- Chart Options (Memoized) ---\n\n  // Generator for common options\n  const commonOptions = useMemo(() => (titleText, xAxisText) => ({\n    responsive: true,\n    maintainAspectRatio: false,\n    // Allow chart to fill container height\n    plugins: {\n      legend: {\n        position: 'top' // Position legend at the top\n      },\n      title: {\n        display: true,\n        text: titleText,\n        // Dynamic title\n        font: {\n          size: 16\n        } // Set title font size\n      },\n      tooltip: {\n        // Base tooltip configuration\n        mode: 'index',\n        // Show tooltips for all datasets at that index\n        intersect: false // Tooltip appears even if not directly hovering over the bar\n      }\n    },\n    scales: {\n      x: {\n        // X-axis configuration\n        title: {\n          display: true,\n          text: xAxisText // Dynamic X-axis label\n        },\n        ticks: {\n          autoSkip: true,\n          // Automatically skip labels if they overlap\n          maxRotation: 45,\n          // Max rotation for labels\n          minRotation: 0 // Min rotation\n        }\n      },\n      y: {\n        // Y-axis configuration\n        beginAtZero: true,\n        // Start Y-axis at 0\n        title: {\n          display: true,\n          text: 'Количество документов' // Y-axis label\n        },\n        ticks: {\n          // Ensure integer ticks for document counts\n          precision: 0\n        }\n      }\n    }\n  }), []); // No dependencies for the function generator itself\n\n  // Specific options for each chart using the common generator\n  const yearlyOptions = useMemo(() => commonOptions(user.role === 1 ? `Количество документов по годам (${getWorkerName() || 'Выбор...'})` : 'Документы по годам', 'Год' // X-axis title\n  ), [commonOptions, user.role, getWorkerName]);\n  const cumulativeOptions = useMemo(() => commonOptions(user.role === 1 ? `Документы по годам с приращением (${getWorkerName() || 'Выбор...'})` : 'Документы по годам с приращением', 'Год' // X-axis title\n  ), [commonOptions, user.role, getWorkerName]);\n\n  // KKS Options with custom tooltip callback\n  const kksOptions = useMemo(() => {\n    const title = user.role === 1 ? `Распределение по критериям ККС (${getWorkerName() || 'Выбор...'})` : 'Распределение по критериям ККС';\n    const baseOpts = commonOptions(title, 'Критерий ККС'); // X-axis title notes abbreviation\n\n    // Customize tooltips specifically for the KKS chart to show full names\n    baseOpts.plugins.tooltip = {\n      ...baseOpts.plugins.tooltip,\n      // Keep existing base settings (mode, intersect)\n      callbacks: {\n        label: function (context) {\n          // Use 'function' to access 'this' if needed, or arrow function\n          try {\n            var _ref, _context$parsed$y, _kksChartResult$fullN;\n            const labelIndex = context.dataIndex; // Index of the data point\n            const count = (_ref = (_context$parsed$y = context.parsed.y) !== null && _context$parsed$y !== void 0 ? _context$parsed$y : context.dataset.data[labelIndex]) !== null && _ref !== void 0 ? _ref : 0; // Get count safely\n\n            // Access the fullNames array prepared earlier (available via closure)\n            // kksChartResult.fullNames should be available in this scope\n            const fullName = (_kksChartResult$fullN = kksChartResult.fullNames) === null || _kksChartResult$fullN === void 0 ? void 0 : _kksChartResult$fullN[labelIndex]; // Use optional chaining\n\n            // Use the full name if available, otherwise fallback to the axis label (short name)\n            const displayLabel = fullName || context.label || ''; // context.label is the short name\n\n            return `${displayLabel}: ${count}`; // Tooltip format: \"Full Name (or Short Name): Count\"\n          } catch (e) {\n            console.error(\"Error in KKS tooltip callback:\", e);\n            // Provide a fallback tooltip text in case of an error\n            return `${context.label || 'Ошибка'}: ${context.parsed.y || 0}`;\n          }\n        }\n      }\n    };\n    return baseOpts;\n  }, [commonOptions, user.role, getWorkerName, kksChartResult.fullNames]); // Dependency on fullNames is crucial for the tooltip\n\n  // --- Helper Function: Format Date (Memoized) ---\n  const formatDate = useCallback(dateString => {\n    if (!dateString) return 'N/A'; // Handle null or empty date strings\n    try {\n      const date = new Date(dateString);\n      // Check if the date object is valid\n      return isNaN(date.getTime()) ? 'Неверная дата' : date.toLocaleDateString('ru-RU'); // Use Russian locale for DD.MM.YYYY\n    } catch (e) {\n      console.error(\"Error formatting date:\", dateString, e);\n      return 'Ошибка даты'; // Return error string if parsing fails\n    }\n  }, []); // No dependencies needed\n\n  // --- Rendering Logic ---\n\n  // Loading State\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"loading\",\n    children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 512,\n    columnNumber: 25\n  }, this);\n\n  // Error State\n  if (error) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"error-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 517,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"header-buttons\",\n      style: {\n        justifyContent: 'center',\n        marginTop: '20px'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleBack,\n        className: \"back-button\",\n        children: \"\\u041D\\u0430\\u0437\\u0430\\u0434\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 520,\n        columnNumber: 18\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 519,\n      columnNumber: 14\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 516,\n    columnNumber: 9\n  }, this);\n\n  // Main Content Render\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"analysis-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"analysis-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"\\u0410\\u043D\\u0430\\u043B\\u0438\\u0437 \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u043E\\u0432\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 532,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"header-buttons\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleBack,\n          className: \"back-button\",\n          children: \"\\u041D\\u0430\\u0437\\u0430\\u0434\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 534,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleLogout,\n          className: \"logout-button\",\n          children: \"\\u0412\\u044B\\u0439\\u0442\\u0438\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 535,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 533,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 531,\n      columnNumber: 13\n    }, this), (user === null || user === void 0 ? void 0 : user.role) === 1 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"controls-container\",\n      children: [workers.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"worker-selector\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"worker-select\",\n          children: \"\\u0420\\u0430\\u0431\\u043E\\u0442\\u043D\\u0438\\u043A:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 545,\n          columnNumber: 30\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          id: \"worker-select\",\n          value: selectedWorker !== null && selectedWorker !== void 0 ? selectedWorker : '' // Controlled component value, handle null state\n          ,\n          onChange: handleWorkerChange,\n          className: \"worker-select\",\n          disabled: loading // Disable while loading (though loading screen handles this mostly)\n          ,\n          children: workers.map(worker => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: worker.ID_Worker,\n            children: worker.FName_Worker || `ID: ${worker.ID_Worker}`\n          }, worker.ID_Worker, false, {\n            fileName: _jsxFileName,\n            lineNumber: 556,\n            columnNumber: 38\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 546,\n          columnNumber: 30\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 544,\n        columnNumber: 26\n      }, this) :\n      /*#__PURE__*/\n      // Message if workers list couldn't be loaded or is empty\n      _jsxDEV(\"p\", {\n        className: \"no-workers-message\",\n        children: \"\\u0421\\u043F\\u0438\\u0441\\u043E\\u043A \\u0440\\u0430\\u0431\\u043E\\u0442\\u043D\\u0438\\u043A\\u043E\\u0432 \\u043D\\u0435 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0436\\u0435\\u043D \\u0438\\u043B\\u0438 \\u043F\\u0443\\u0441\\u0442.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 565,\n        columnNumber: 26\n      }, this), selectedWorker !== null && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"view-mode-buttons\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: `view-mode-button ${viewMode === 'analysis' ? 'active' : ''}`,\n          onClick: () => handleViewModeChange('analysis'),\n          \"aria-pressed\": viewMode === 'analysis' // Accessibility\n          ,\n          children: \"\\u0410\\u043D\\u0430\\u043B\\u0438\\u0437 (\\u0413\\u0440\\u0430\\u0444\\u0438\\u043A\\u0438)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 571,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `view-mode-button ${viewMode === 'documents' ? 'active' : ''}`,\n          onClick: () => handleViewModeChange('documents'),\n          \"aria-pressed\": viewMode === 'documents' // Accessibility\n          ,\n          children: \"\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B (\\u0421\\u043F\\u0438\\u0441\\u043E\\u043A)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 578,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 570,\n        columnNumber: 25\n      }, this), selectedWorker === null && workers.length > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"select-worker-prompt\",\n        children: \"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0440\\u0430\\u0431\\u043E\\u0442\\u043D\\u0438\\u043A\\u0430 \\u0434\\u043B\\u044F \\u043F\\u0440\\u043E\\u0441\\u043C\\u043E\\u0442\\u0440\\u0430 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 588,\n        columnNumber: 27\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 541,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content-area\",\n      children: viewMode === 'analysis' ?\n      /*#__PURE__*/\n      // --- Analysis View (Charts) ---\n      _jsxDEV(\"div\", {\n        className: \"charts-grid\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"k-coefficient-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"\\u041A\\u043E\\u044D\\u0444\\u0444\\u0438\\u0446\\u0438\\u0435\\u043D\\u0442 \\u0434\\u0438\\u043D\\u0430\\u043C\\u0438\\u043A\\u0438 \\u041A\\u041A\\u0421\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 600,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"k-value\",\n            children: kCoefficient\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 601,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"k-description\",\n            children: \"\\u041A\\u043E\\u044D\\u0444\\u0444\\u0438\\u0446\\u0438\\u0435\\u043D\\u0442 K \\u043F\\u043E\\u043A\\u0430\\u0437\\u044B\\u0432\\u0430\\u0435\\u0442 \\u0441\\u0443\\u043C\\u043C\\u0443 \\u043F\\u0440\\u0438\\u0440\\u0430\\u0449\\u0435\\u043D\\u0438\\u0439 \\u043A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u0430 \\u0414\\u041E\\u041A, \\u043F\\u043E\\u043B\\u0443\\u0447\\u0435\\u043D\\u043D\\u044B\\u0445 \\u043A \\u043A\\u0430\\u0436\\u0434\\u043E\\u043C\\u0443 \\u0433\\u043E\\u0434\\u0443 \\u0432 \\u043F\\u0435\\u0440\\u0438\\u043E\\u0434\\u0435 \\u043E\\u0446\\u0435\\u043D\\u043A\\u0438. \\u0427\\u0435\\u043C \\u0432\\u044B\\u0448\\u0435 \\u0437\\u043D\\u0430\\u0447\\u0435\\u043D\\u0438\\u0435 K, \\u0442\\u0435\\u043C \\u0431\\u043E\\u043B\\u0435\\u0435 \\u043F\\u0440\\u043E\\u0433\\u0440\\u0435\\u0441\\u0441\\u0438\\u0432\\u043D\\u044B\\u043C \\u044F\\u0432\\u043B\\u044F\\u0435\\u0442\\u0441\\u044F \\u0440\\u043E\\u0441\\u0442 \\u043A\\u0432\\u0430\\u043B\\u0438\\u0444\\u0438\\u043A\\u0430\\u0446\\u0438\\u0438 \\u0440\\u0430\\u0431\\u043E\\u0442\\u043D\\u0438\\u043A\\u0430.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 602,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 599,\n          columnNumber: 25\n        }, this), (user.role !== 1 || selectedWorker !== null) && filteredDocuments.length > 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chart-wrapper\",\n            children: yearlyChartResult.years.length > 0 ? /*#__PURE__*/_jsxDEV(Bar, {\n              options: yearlyOptions,\n              data: yearlyData\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 614,\n              columnNumber: 43\n            }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"no-data-message\",\n              children: \"\\u041D\\u0435\\u0442 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043F\\u043E \\u0433\\u043E\\u0434\\u0430\\u043C.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 616,\n              columnNumber: 43\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 612,\n            columnNumber: 34\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chart-wrapper\",\n            children: yearlyChartResult.years.length > 0 ? /*#__PURE__*/_jsxDEV(Bar, {\n              options: cumulativeOptions,\n              data: cumulativeData\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 622,\n              columnNumber: 43\n            }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"no-data-message\",\n              children: \"\\u041D\\u0435\\u0442 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043F\\u043E \\u0433\\u043E\\u0434\\u0430\\u043C.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 624,\n              columnNumber: 45\n            }, this) // Redundant but harmless\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 620,\n            columnNumber: 34\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chart-wrapper kks-chart-wrapper\",\n            children: kksChartResult.labels.length > 0 ? /*#__PURE__*/_jsxDEV(Bar, {\n              options: kksOptions,\n              data: kksData\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 631,\n              columnNumber: 43\n            }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"no-data-message\",\n              children: \"\\u041D\\u0435\\u0442 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043F\\u043E \\u043A\\u0440\\u0438\\u0442\\u0435\\u0440\\u0438\\u044F\\u043C \\u041A\\u041A\\u0421 \\u0434\\u043B\\u044F \\u043E\\u0442\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u044F.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 633,\n              columnNumber: 43\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 628,\n            columnNumber: 34\n          }, this)]\n        }, void 0, true) :\n        /*#__PURE__*/\n        // Message when no documents are available for the current view/filter\n        _jsxDEV(\"div\", {\n          className: \"no-data-message full-width-message\",\n          children: user.role === 1 ? selectedWorker === null ? \"Пожалуйста, выберите работника для просмотра анализа.\" : `Нет документов для анализа у выбранного работника (${getWorkerName()}).` : \"У вас пока нет загруженных документов для анализа.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 639,\n          columnNumber: 30\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 597,\n        columnNumber: 21\n      }, this) :\n      /*#__PURE__*/\n      // --- Documents View (Table) ---\n      _jsxDEV(\"div\", {\n        className: \"documents-list\",\n        children: (user.role !== 1 || selectedWorker !== null) && filteredDocuments.length > 0 ? /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"documents-table\",\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [renderSortableHeader('Программа обучения', 'ProgramName'), renderSortableHeader('Организация', 'OrgSName'), renderSortableHeader('Рег. номер', 'regnumber'), renderSortableHeader('Дата выдачи', 'DateIssue'), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u044F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 660,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 654,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 653,\n            columnNumber: 35\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: filteredDocuments.map(doc => /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: doc.ProgramName || 'N/A'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 667,\n                columnNumber: 47\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: doc.OrgSName || doc.OrgFName || 'N/A'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 668,\n                columnNumber: 47\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"td\", {\n                children: doc.regnumber || 'N/A'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 669,\n                columnNumber: 47\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: formatDate(doc.DateIssue)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 670,\n                columnNumber: 47\n              }, this), \" \", /*#__PURE__*/_jsxDEV(\"td\", {\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"details-button\",\n                  onClick: () => openModal(doc) // Pass the whole document object\n                  ,\n                  children: \"\\u0414\\u043E\\u043F\\u043E\\u043B\\u043D\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 673,\n                  columnNumber: 51\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 671,\n                columnNumber: 47\n              }, this)]\n            }, doc.ID_Document, true, {\n              fileName: _jsxFileName,\n              lineNumber: 665,\n              columnNumber: 43\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 663,\n            columnNumber: 35\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 652,\n          columnNumber: 31\n        }, this) :\n        /*#__PURE__*/\n        // Message when no documents are available for the table view\n        _jsxDEV(\"div\", {\n          className: \"no-data-message full-width-message\",\n          children: user.role === 1 ? selectedWorker === null ? \"Пожалуйста, выберите работника для просмотра списка документов.\" : `Нет документов для отображения у выбранного работника (${getWorkerName()}).` : \"У вас пока нет загруженных документов.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 686,\n          columnNumber: 31\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 649,\n        columnNumber: 22\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 594,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      isOpen: isModalOpen,\n      onRequestClose: closeModal,\n      contentLabel: \"\\u0414\\u0435\\u0442\\u0430\\u043B\\u0438 \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0430\" // Accessibility label\n      ,\n      className: \"modal-content\" // Class for styling the modal content\n      ,\n      overlayClassName: \"modal-overlay\" // Class for styling the background overlay\n      ,\n      ariaHideApp: true // Helps with screen readers\n      ,\n      children: selectedDocumentForModal ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: [\"\\u0414\\u0435\\u0442\\u0430\\u043B\\u0438 \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0430 \\u2116 \", selectedDocumentForModal.regnumber || selectedDocumentForModal.ID_Document]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 710,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: closeModal,\n          className: \"modal-close-button\",\n          \"aria-label\": \"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\",\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 711,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-details-grid\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u0420\\u0430\\u0431\\u043E\\u0442\\u043D\\u0438\\u043A:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 716,\n              columnNumber: 34\n            }, this), \" \", selectedDocumentForModal.WorkerName || getWorkerName() || 'N/A']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 716,\n            columnNumber: 31\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u041F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u043C\\u0430 \\u043E\\u0431\\u0443\\u0447\\u0435\\u043D\\u0438\\u044F:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 717,\n              columnNumber: 34\n            }, this), \" \", selectedDocumentForModal.ProgramName || 'N/A']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 717,\n            columnNumber: 31\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u041E\\u0440\\u0433\\u0430\\u043D\\u0438\\u0437\\u0430\\u0446\\u0438\\u044F (\\u043F\\u043E\\u043B\\u043D\\u043E\\u0435):\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 718,\n              columnNumber: 34\n            }, this), \" \", selectedDocumentForModal.OrgFName || 'N/A']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 718,\n            columnNumber: 31\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u041E\\u0440\\u0433\\u0430\\u043D\\u0438\\u0437\\u0430\\u0446\\u0438\\u044F (\\u043A\\u0440\\u0430\\u0442\\u043A\\u043E\\u0435):\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 719,\n              columnNumber: 34\n            }, this), \" \", selectedDocumentForModal.OrgSName || 'N/A']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 719,\n            columnNumber: 31\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u0420\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u043E\\u043D\\u043D\\u044B\\u0439 \\u043D\\u043E\\u043C\\u0435\\u0440:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 720,\n              columnNumber: 34\n            }, this), \" \", selectedDocumentForModal.regnumber || 'N/A']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 720,\n            columnNumber: 31\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u0414\\u0430\\u0442\\u0430 \\u0432\\u044B\\u0434\\u0430\\u0447\\u0438:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 721,\n              columnNumber: 34\n            }, this), \" \", formatDate(selectedDocumentForModal.DateIssue)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 721,\n            columnNumber: 31\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"kks-details\",\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u041A\\u0440\\u0438\\u0442\\u0435\\u0440\\u0438\\u0438 \\u041A\\u041A\\u0421:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 726,\n              columnNumber: 34\n            }, this), Array.isArray(selectedDocumentForModal.KKS_Data) && selectedDocumentForModal.KKS_Data.length > 0 ? selectedDocumentForModal.KKS_Data.map(k => k.fullName || k.shortName) // Prefer full name, fallback to short\n            .filter(Boolean) // Remove any null/empty values\n            .join(', ') // Join with comma and space\n            : 'Нет данных', \" \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 725,\n            columnNumber: 30\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 714,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true) :\n      /*#__PURE__*/\n      // Fallback message if modal opens before data is ready (shouldn't usually happen)\n      _jsxDEV(\"p\", {\n        children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0434\\u0435\\u0442\\u0430\\u043B\\u0435\\u0439...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 739,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 698,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 529,\n    columnNumber: 9\n  }, this);\n}\n_s(DocumentAnalysis, \"iPB45zTZjEGceiVHRAUv7giZxik=\", false, function () {\n  return [useNavigate];\n});\n_c = DocumentAnalysis;\nexport default DocumentAnalysis;\nvar _c;\n$RefreshReg$(_c, \"DocumentAnalysis\");","map":{"version":3,"names":["React","useState","useEffect","useMemo","useCallback","axios","useNavigate","Modal","Chart","ChartJS","CategoryScale","LinearScale","BarElement","Title","Tooltip","Legend","Bar","jsxDEV","_jsxDEV","Fragment","_Fragment","apiUrl","process","env","REACT_APP_API_URL","setAppElement","register","DocumentAnalysis","_s","documents","setDocuments","workers","setWorkers","selectedWorker","setSelectedWorker","loading","setLoading","error","setError","viewMode","setViewMode","isModalOpen","setIsModalOpen","selectedDocumentForModal","setSelectedDocumentForModal","sortConfig","setSortConfig","key","direction","navigate","user","JSON","parse","localStorage","getItem","requestSort","sortDocuments","docs","config","sort","a","b","includes","dateA","Date","getTime","dateB","valA","valB","String","toLowerCase","renderSortableHeader","label","onClick","className","style","cursor","children","fileName","_jsxFileName","lineNumber","columnNumber","getWorkerName","role","Array","isArray","worker","find","w","ID_Worker","FName_Worker","fetchData","documentsResponse","get","params","userId","workerId","data","console","Error","log","length","_documentsResponse$da","KKS_Data","workersResponse","err","_err$response","_err$response$data","response","message","handleLogout","removeItem","handleBack","handleWorkerChange","event","workerIdValue","target","value","parseInt","handleViewModeChange","mode","openModal","doc","closeModal","filteredDocuments","filtered","filter","prepareYearlyChartData","documentsByYear","reduce","acc","DateIssue","date","isNaN","year","getFullYear","warn","ID_Document","e","yearsInData","Object","keys","map","Number","currentYear","minDataYear","Math","min","maxDataYear","max","startYear","endYear","allYears","push","counts","cumulativeCounts","count","index","years","prepareKKSChartData","kksAggregated","kksItems","forEach","item","_item$shortName","_item$fullName","shortName","trim","fullName","sortedShortNames","localeCompare","labels","fullNames","yearlyChartResult","kksChartResult","calculateK","K","i","diff","kCoefficient","yearlyData","datasets","backgroundColor","borderColor","borderWidth","cumulativeData","kksData","commonOptions","titleText","xAxisText","responsive","maintainAspectRatio","plugins","legend","position","title","display","text","font","size","tooltip","intersect","scales","x","ticks","autoSkip","maxRotation","minRotation","y","beginAtZero","precision","yearlyOptions","cumulativeOptions","kksOptions","baseOpts","callbacks","context","_ref","_context$parsed$y","_kksChartResult$fullN","labelIndex","dataIndex","parsed","dataset","displayLabel","formatDate","dateString","toLocaleDateString","justifyContent","marginTop","htmlFor","id","onChange","disabled","options","ProgramName","OrgSName","OrgFName","regnumber","isOpen","onRequestClose","contentLabel","overlayClassName","ariaHideApp","WorkerName","k","Boolean","join","_c","$RefreshReg$"],"sources":["D:/Amina/VScode/FQW_new/src/components/DocumentAnalysis.js"],"sourcesContent":["import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport Modal from 'react-modal';\nimport {\n    Chart as ChartJS,\n    CategoryScale,\n    LinearScale,\n    BarElement,\n    Title,\n    Tooltip,\n    Legend\n} from 'chart.js';\nimport { Bar } from 'react-chartjs-2';\nimport './DocumentAnalysis.css'; // Make sure this CSS file exists and is styled appropriately\n\nconst apiUrl = process.env.REACT_APP_API_URL\n\n// Set the app element for react-modal accessibility\nModal.setAppElement('#root'); // Adjust '#root' if your app's root element has a different ID\n\n// Register Chart.js components\nChartJS.register(\n    CategoryScale,\n    LinearScale,\n    BarElement,\n    Title,\n    Tooltip,\n    Legend\n);\n\nfunction DocumentAnalysis() {\n    // State Variables\n    const [documents, setDocuments] = useState([]);\n    const [workers, setWorkers] = useState([]);\n    const [selectedWorker, setSelectedWorker] = useState(null); // Store worker ID\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState('');\n    const [viewMode, setViewMode] = useState('analysis'); // 'analysis' or 'documents'\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [selectedDocumentForModal, setSelectedDocumentForModal] = useState(null);\n    const [sortConfig, setSortConfig] = useState({ key: 'DateIssue', direction: 'descending' }); // Added sort state\n    \n    // Hooks\n    const navigate = useNavigate();\n    const user = JSON.parse(localStorage.getItem('user')); // Assuming user info is stored here\n\n    // Sort function\n    const requestSort = (key) => {\n        let direction = 'ascending';\n        if (sortConfig.key === key && sortConfig.direction === 'ascending') {\n            direction = 'descending';\n        }\n        setSortConfig({ key, direction });\n    };\n\n    // Helper function to sort documents\n    const sortDocuments = (docs, config) => {\n        if (!config.key) return docs;\n        \n        return [...docs].sort((a, b) => {\n            // Handle date fields specially\n            if (['DateIssue', 'DataStart', 'DataEnd'].includes(config.key)) {\n                const dateA = a[config.key] ? new Date(a[config.key]).getTime() : 0;\n                const dateB = b[config.key] ? new Date(b[config.key]).getTime() : 0;\n                if (dateA < dateB) {\n                    return config.direction === 'ascending' ? -1 : 1;\n                }\n                if (dateA > dateB) {\n                    return config.direction === 'ascending' ? 1 : -1;\n                }\n                return 0;\n            }\n            \n            // Handle numeric fields\n            if (['ID_Document', 'ID_Worker', 'ID_ProgDPO'].includes(config.key)) {\n                const valA = a[config.key] || 0;\n                const valB = b[config.key] || 0;\n                return config.direction === 'ascending' ? valA - valB : valB - valA;\n            }\n            \n            // Handle string fields\n            const valA = String(a[config.key] || '').toLowerCase();\n            const valB = String(b[config.key] || '').toLowerCase();\n            if (valA < valB) {\n                return config.direction === 'ascending' ? -1 : 1;\n            }\n            if (valA > valB) {\n                return config.direction === 'ascending' ? 1 : -1;\n            }\n            return 0;\n        });\n    };\n\n    // Render sortable header\n    const renderSortableHeader = (label, key) => (\n        <th \n            onClick={() => requestSort(key)} \n            className=\"sortable-header\"\n            style={{ cursor: 'pointer' }}\n        >\n            {label} \n            {sortConfig.key === key ? (\n                sortConfig.direction === 'ascending' ? ' ▲' : ' ▼'\n            ) : ' ↕'}\n        </th>\n    );\n\n    // --- Helper Function: Get Worker Name (Memoized) ---\n    const getWorkerName = useCallback(() => {\n        // Ensure workers is an array before using find\n        if (user?.role !== 1 || !selectedWorker || !Array.isArray(workers)) return '';\n        const worker = workers.find(w => w.ID_Worker === selectedWorker);\n        return worker ? worker.FName_Worker : `ID ${selectedWorker}`; // Use FName_Worker or adjust as needed\n    }, [user?.role, selectedWorker, workers]); // Dependencies for getWorkerName\n\n    // --- useEffect for Data Fetching ---\n    useEffect(() => {\n        const fetchData = async () => {\n            setLoading(true);\n            setError('');\n            try {\n                // Fetch documents based on user ID and role\n                const documentsResponse = await axios.get(`${apiUrl}/api/documents`, {\n                    params: { userId: user.workerId, role: user.role }\n                });\n\n                // Validate documents response\n                if (!Array.isArray(documentsResponse.data)) {\n                    console.error('Documents API did not return an array:', documentsResponse.data);\n                    throw new Error('Неверный формат данных документов');\n                }\n                setDocuments(documentsResponse.data);\n                console.log(\"Frontend: Documents received:\", documentsResponse.data.length);\n                 if (documentsResponse.data.length > 0) {\n                     // Log the structure of KKS_Data for the first doc for verification\n                     console.log(\"Frontend: Sample KKS_Data in first doc:\", documentsResponse.data[0]?.KKS_Data);\n                 }\n\n                // Fetch workers list if the user is an admin (role === 1)\n                if (user.role === 1) {\n                    const workersResponse = await axios.get(`${apiUrl}/api/workers`);\n\n                    // Validate workers response\n                    if (!Array.isArray(workersResponse.data)) {\n                         console.error(\"Workers API did not return an array:\", workersResponse.data);\n                         setWorkers([]); // Set empty array on error\n                    } else {\n                        setWorkers(workersResponse.data);\n                        // Set the initial selected worker ONLY if workers exist and NO worker is currently selected\n                        // This prevents resetting selection if the component re-renders for other reasons\n                        if (workersResponse.data.length > 0 && selectedWorker === null) {\n                            setSelectedWorker(workersResponse.data[0].ID_Worker);\n                        } else if (workersResponse.data.length === 0) {\n                             setSelectedWorker(null); // No workers available\n                        }\n                    }\n                } else {\n                    // Not an admin, clear workers and selection\n                    setWorkers([]);\n                    setSelectedWorker(null);\n                }\n\n            } catch (err) {\n                console.error('Ошибка при загрузке данных:', err);\n                setError(err.response?.data?.error || err.message || 'Не удалось загрузить данные');\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        if (user?.workerId) {\n            fetchData();\n        } else {\n            setError(\"Пользователь не найден. Пожалуйста, войдите снова.\");\n            setLoading(false);\n            // Optional: Redirect to login\n            // navigate('/login');\n        }\n        // Dependency array includes user info and selectedWorker (to potentially refetch if admin changes worker, though filtering handles display)\n        // Note: Adding selectedWorker here caused a re-fetch loop in v1 - be careful. Let's keep it based on user info for initial load.\n        // Re-filtering happens via useMemo when selectedWorker changes.\n    }, [user?.workerId, user?.role]); // Re-run effect if user ID or role changes\n\n\n    // --- Event Handlers ---\n    const handleLogout = () => {\n        localStorage.removeItem('user');\n        navigate('/login');\n    };\n\n    const handleBack = () => {\n        // Navigate back based on user role\n        navigate(user?.role === 1 ? '/admin' : '/user'); // Navigate to admin or user dashboard\n    };\n\n    const handleWorkerChange = (event) => {\n        const workerIdValue = event.target.value;\n        // Parse to integer, handle potential empty string value from a \"--Select--\" option\n        const workerId = workerIdValue ? parseInt(workerIdValue, 10) : null;\n        setSelectedWorker(workerId);\n    };\n\n    const handleViewModeChange = (mode) => {\n        setViewMode(mode);\n    };\n\n    // --- Modal Handlers ---\n    const openModal = (doc) => {\n        console.log(\"Opening modal for doc:\", doc);\n        setSelectedDocumentForModal(doc);\n        setIsModalOpen(true);\n    };\n\n    const closeModal = () => {\n        setIsModalOpen(false);\n        setSelectedDocumentForModal(null); // Clear selected doc when closing\n    };\n\n    // --- Filtered Documents (Memoized) ---\n    const filteredDocuments = useMemo(() => {\n        if (loading || !Array.isArray(documents)) return [];\n    \n        let filtered = documents;\n        if (user?.role === 1) {\n            filtered = selectedWorker !== null\n                ? documents.filter(doc => doc.ID_Worker === selectedWorker)\n                : [];\n        }\n        \n        return sortDocuments(filtered, sortConfig);\n    }, [documents, selectedWorker, user?.role, loading, sortConfig]);\n\n    // --- Chart Data Preparation Functions (Memoized with useCallback) ---\n\n    // 1. Yearly & Cumulative Chart Data\n    const prepareYearlyChartData = useCallback((docs) => {\n        const documentsByYear = docs.reduce((acc, doc) => {\n            try {\n                // Ensure DateIssue exists and is a valid date string\n                if (doc.DateIssue) {\n                    const date = new Date(doc.DateIssue);\n                    if (!isNaN(date.getTime())) { // Check if date is valid\n                        const year = date.getFullYear();\n                        acc[year] = (acc[year] || 0) + 1;\n                    } else {\n                        console.warn(\"Invalid DateIssue format:\", doc.ID_Document, doc.DateIssue);\n                    }\n                } else {\n                    console.warn(\"Missing DateIssue:\", doc.ID_Document);\n                }\n            } catch (e) {\n                console.error(\"Error parsing DateIssue:\", doc.ID_Document, doc.DateIssue, e);\n            }\n            return acc;\n        }, {});\n\n        const yearsInData = Object.keys(documentsByYear).map(Number).sort((a, b) => a - b);\n        const currentYear = new Date().getFullYear();\n\n        const minDataYear = yearsInData.length > 0 ? Math.min(...yearsInData) : currentYear;\n        const maxDataYear = yearsInData.length > 0 ? Math.max(...yearsInData) : currentYear;\n\n        // Determine the range of years for the chart (from earliest data year to at least the current year)\n        const startYear = minDataYear;\n        const endYear = Math.max(maxDataYear, currentYear);\n\n        const allYears = [];\n        // Populate all years in the range\n        if (startYear <= endYear) {\n            for (let year = startYear; year <= endYear; year++) {\n                allYears.push(year);\n            }\n        } else if (docs.length === 0) { // Handle case with no documents - maybe show current year?\n            // Optionally add current year: allYears.push(currentYear);\n        }\n\n        // Map counts for each year in the final range\n        const counts = allYears.map(year => documentsByYear[year] || 0);\n\n        // Calculate cumulative counts\n        const cumulativeCounts = counts.reduce((acc, count, index) => {\n            acc.push(index === 0 ? count : (acc[index - 1] || 0) + count);\n            return acc;\n        }, []);\n\n        return { years: allYears, counts, cumulativeCounts };\n    }, []); // useCallback as the function definition itself doesn't depend on props/state\n\n    // 2. KKS Criteria Chart Data (Processing KKS_Data array)\n    const prepareKKSChartData = useCallback((docs) => {\n        // Aggregate counts per KKS criterion (using shortName as key)\n        const kksAggregated = docs.reduce((acc, doc) => {\n            const kksItems = doc.KKS_Data; // Expecting an array like [{ shortName: '..', fullName: '..' }, ...]\n\n            // Check if kksItems is a valid array\n            if (Array.isArray(kksItems)) {\n                kksItems.forEach(item => {\n                    const shortName = item?.shortName?.trim(); // Use optional chaining and trim\n                    const fullName = item?.fullName?.trim();\n\n                    if (shortName) { // Process only if shortName exists\n                        if (!acc[shortName]) {\n                            // Initialize entry for this shortName if it's the first time seen\n                            acc[shortName] = {\n                                shortName: shortName,\n                                fullName: fullName || shortName, // Use shortName as fallback if fullName is missing\n                                count: 0\n                            };\n                        }\n                        // Increment the count for this KKS criterion\n                        acc[shortName].count += 1;\n                    } else {\n                         console.warn(\"KKS item missing shortName in doc:\", doc.ID_Document, item);\n                    }\n                });\n            } else if (kksItems) {\n                 // Log if KKS_Data exists but isn't an array (should be handled by backend ideally)\n                 console.error(\"KKS_Data is not an array for doc:\", doc.ID_Document, kksItems);\n            }\n            // If KKS_Data is null/undefined or invalid, just skip and continue\n\n            return acc;\n        }, {}); // Initial value is an empty object\n\n        // Sort aggregated data by shortName for consistent chart axis order\n        const sortedShortNames = Object.keys(kksAggregated).sort((a, b) => a.localeCompare(b));\n\n        // Extract data arrays needed for Chart.js\n        const labels = sortedShortNames; // X-axis labels will be the Short Names\n        const fullNames = sortedShortNames.map(key => kksAggregated[key].fullName); // Full Names for tooltips\n        const counts = sortedShortNames.map(key => kksAggregated[key].count); // Bar heights\n\n        console.log(\"Prepared KKS Chart Data:\", { labels, fullNames, counts }); // Log for debugging\n\n        return {\n            labels: labels,       // Short names for axis\n            fullNames: fullNames, // Full names for tooltips\n            counts: counts        // Counts for bar heights\n        };\n    }, []); // useCallback as the function definition is stable\n\n    // --- Memoized Chart Results ---\n    // These recalculate only when filteredDocuments or the prep function changes (which it won't due to useCallback)\n    const yearlyChartResult = useMemo(() => prepareYearlyChartData(filteredDocuments), [filteredDocuments, prepareYearlyChartData]);\n    const kksChartResult = useMemo(() => prepareKKSChartData(filteredDocuments), [filteredDocuments, prepareKKSChartData]);\n\n    // --- Расчет коэффициента K ---\n    const calculateK = useCallback((cumulativeCounts) => {\n        if (!Array.isArray(cumulativeCounts) || cumulativeCounts.length < 2) return 0;\n        \n        let K = 0;\n        for (let i = 1; i < cumulativeCounts.length; i++) {\n            const diff = cumulativeCounts[i] - cumulativeCounts[i-1];\n            if (diff > 0) {\n                K += diff;\n            }\n        }\n        return K;\n    }, []);\n\n    const kCoefficient = useMemo(() => {\n        return calculateK(yearlyChartResult.cumulativeCounts);\n    }, [yearlyChartResult.cumulativeCounts, calculateK]);\n\n    // --- Memoized Chart Data Objects (for react-chartjs-2) ---\n    const yearlyData = useMemo(() => ({\n        labels: yearlyChartResult.years,\n        datasets: [{\n            label: user.role === 1 ? `Документы по годам` : 'Документы по годам',\n            data: yearlyChartResult.counts,\n            backgroundColor: 'rgba(54, 162, 235, 0.6)', // Blue\n            borderColor: 'rgba(54, 162, 235, 1)',\n            borderWidth: 1,\n        }],\n    }), [yearlyChartResult, user.role, getWorkerName]); // Update when results or worker name changes\n\n    const cumulativeData = useMemo(() => ({\n        labels: yearlyChartResult.years,\n        datasets: [{\n            label: user.role === 1 ? `Документы по годам с приращением` : 'Документы по годам с приращением',\n            data: yearlyChartResult.cumulativeCounts,\n            backgroundColor: 'rgba(75, 192, 192, 0.6)', // Teal\n            borderColor: 'rgba(75, 192, 192, 1)',\n            borderWidth: 1,\n        }],\n    }), [yearlyChartResult, user.role, getWorkerName]); // Update when results or worker name changes\n\n    const kksData = useMemo(() => ({\n        labels: kksChartResult.labels, // Use SHORT names for axis labels\n        datasets: [{\n            label: user.role === 1 ? `Документы по критериям ККС` : 'Документы по критериям ККС',\n            data: kksChartResult.counts,\n            backgroundColor: 'rgba(255, 159, 64, 0.6)', // Orange\n            borderColor: 'rgba(255, 159, 64, 1)',\n            borderWidth: 1,\n        }],\n    }), [kksChartResult, user.role, getWorkerName]); // Update when KKS results or worker name changes\n\n    // --- Chart Options (Memoized) ---\n\n    // Generator for common options\n     const commonOptions = useMemo(() => (titleText, xAxisText) => ({\n         responsive: true,\n         maintainAspectRatio: false, // Allow chart to fill container height\n         plugins: {\n             legend: {\n                 position: 'top', // Position legend at the top\n             },\n             title: {\n                 display: true,\n                 text: titleText, // Dynamic title\n                 font: { size: 16 }, // Set title font size\n             },\n             tooltip: { // Base tooltip configuration\n                 mode: 'index', // Show tooltips for all datasets at that index\n                 intersect: false, // Tooltip appears even if not directly hovering over the bar\n             }\n         },\n         scales: {\n             x: { // X-axis configuration\n                 title: {\n                     display: true,\n                     text: xAxisText, // Dynamic X-axis label\n                 },\n                 ticks: {\n                     autoSkip: true, // Automatically skip labels if they overlap\n                     maxRotation: 45, // Max rotation for labels\n                     minRotation: 0 // Min rotation\n                 }\n             },\n             y: { // Y-axis configuration\n                 beginAtZero: true, // Start Y-axis at 0\n                 title: {\n                     display: true,\n                     text: 'Количество документов', // Y-axis label\n                 },\n                 ticks: {\n                      // Ensure integer ticks for document counts\n                     precision: 0\n                 }\n             },\n         },\n     }), []); // No dependencies for the function generator itself\n\n    // Specific options for each chart using the common generator\n    const yearlyOptions = useMemo(() => commonOptions(\n        user.role === 1 ? `Количество документов по годам (${getWorkerName() || 'Выбор...'})` : 'Документы по годам',\n        'Год' // X-axis title\n    ), [commonOptions, user.role, getWorkerName]);\n\n    const cumulativeOptions = useMemo(() => commonOptions(\n        user.role === 1 ? `Документы по годам с приращением (${getWorkerName() || 'Выбор...'})` : 'Документы по годам с приращением',\n        'Год' // X-axis title\n    ), [commonOptions, user.role, getWorkerName]);\n\n    // KKS Options with custom tooltip callback\n    const kksOptions = useMemo(() => {\n        const title = user.role === 1\n            ? `Распределение по критериям ККС (${getWorkerName() || 'Выбор...'})`\n            : 'Распределение по критериям ККС';\n        const baseOpts = commonOptions(title, 'Критерий ККС'); // X-axis title notes abbreviation\n\n        // Customize tooltips specifically for the KKS chart to show full names\n        baseOpts.plugins.tooltip = {\n            ...baseOpts.plugins.tooltip, // Keep existing base settings (mode, intersect)\n            callbacks: {\n                label: function(context) { // Use 'function' to access 'this' if needed, or arrow function\n                    try {\n                        const labelIndex = context.dataIndex; // Index of the data point\n                        const count = context.parsed.y ?? context.dataset.data[labelIndex] ?? 0; // Get count safely\n\n                        // Access the fullNames array prepared earlier (available via closure)\n                        // kksChartResult.fullNames should be available in this scope\n                        const fullName = kksChartResult.fullNames?.[labelIndex]; // Use optional chaining\n\n                        // Use the full name if available, otherwise fallback to the axis label (short name)\n                        const displayLabel = fullName || context.label || ''; // context.label is the short name\n\n                        return `${displayLabel}: ${count}`; // Tooltip format: \"Full Name (or Short Name): Count\"\n                    } catch (e) {\n                        console.error(\"Error in KKS tooltip callback:\", e);\n                        // Provide a fallback tooltip text in case of an error\n                        return `${context.label || 'Ошибка'}: ${context.parsed.y || 0}`;\n                    }\n                }\n            }\n        };\n\n        return baseOpts;\n\n    }, [commonOptions, user.role, getWorkerName, kksChartResult.fullNames]); // Dependency on fullNames is crucial for the tooltip\n\n\n    // --- Helper Function: Format Date (Memoized) ---\n     const formatDate = useCallback((dateString) => {\n         if (!dateString) return 'N/A'; // Handle null or empty date strings\n         try {\n             const date = new Date(dateString);\n             // Check if the date object is valid\n             return isNaN(date.getTime()) ? 'Неверная дата' : date.toLocaleDateString('ru-RU'); // Use Russian locale for DD.MM.YYYY\n         } catch (e) {\n             console.error(\"Error formatting date:\", dateString, e);\n             return 'Ошибка даты'; // Return error string if parsing fails\n         }\n     }, []); // No dependencies needed\n\n\n    // --- Rendering Logic ---\n\n    // Loading State\n    if (loading) return <div className=\"loading\">Загрузка данных...</div>;\n\n    // Error State\n    if (error) return (\n        <div className=\"error-container\">\n            <div className=\"error\">{error}</div>\n            {/* Provide buttons even on error */}\n             <div className=\"header-buttons\" style={{ justifyContent: 'center', marginTop: '20px' }}>\n                 <button onClick={handleBack} className=\"back-button\">Назад</button>\n                  {/* Optionally show logout even on error */}\n                 {/* <button onClick={handleLogout} className=\"logout-button\">Выйти</button> */}\n             </div>\n        </div>\n    );\n\n    // Main Content Render\n    return (\n        <div className=\"analysis-container\">\n            {/* Header Section */}\n            <div className=\"analysis-header\">\n                <h1>Анализ документов</h1>\n                <div className=\"header-buttons\">\n                    <button onClick={handleBack} className=\"back-button\">Назад</button>\n                    <button onClick={handleLogout} className=\"logout-button\">Выйти</button>\n                </div>\n            </div>\n\n            {/* Controls Section (Admin only) */}\n            {user?.role === 1 && (\n                <div className=\"controls-container\">\n                    {/* Worker Selector Dropdown */}\n                     {workers.length > 0 ? (\n                         <div className=\"worker-selector\">\n                             <label htmlFor=\"worker-select\">Работник:</label>\n                             <select\n                                 id=\"worker-select\"\n                                 value={selectedWorker ?? ''} // Controlled component value, handle null state\n                                 onChange={handleWorkerChange}\n                                 className=\"worker-select\"\n                                 disabled={loading} // Disable while loading (though loading screen handles this mostly)\n                             >\n                                  {/* Optional: Default unselectable option */}\n                                 {/* <option value=\"\" disabled>-- Выберите работника --</option> */}\n                                 {workers.map(worker => (\n                                     <option key={worker.ID_Worker} value={worker.ID_Worker}>\n                                         {/* Display worker name - ensure FName_Worker or similar exists */}\n                                         {worker.FName_Worker || `ID: ${worker.ID_Worker}`}\n                                     </option>\n                                 ))}\n                             </select>\n                         </div>\n                     ) : (\n                          // Message if workers list couldn't be loaded or is empty\n                         <p className=\"no-workers-message\">Список работников не загружен или пуст.</p>\n                     )}\n\n                    {/* View Mode Toggle Buttons (Show only if a worker is selected) */}\n                    {selectedWorker !== null && (\n                        <div className=\"view-mode-buttons\">\n                            <button\n                                className={`view-mode-button ${viewMode === 'analysis' ? 'active' : ''}`}\n                                onClick={() => handleViewModeChange('analysis')}\n                                aria-pressed={viewMode === 'analysis'} // Accessibility\n                            >\n                                Анализ (Графики)\n                            </button>\n                            <button\n                                className={`view-mode-button ${viewMode === 'documents' ? 'active' : ''}`}\n                                onClick={() => handleViewModeChange('documents')}\n                                aria-pressed={viewMode === 'documents'} // Accessibility\n                            >\n                                Документы (Список)\n                            </button>\n                        </div>\n                    )}\n                     {selectedWorker === null && workers.length > 0 && (\n                          <p className=\"select-worker-prompt\">Выберите работника для просмотра данных.</p>\n                     )}\n                </div>\n            )}\n\n            {/* Content Area: Charts or Table */}\n            <div className=\"content-area\">\n                {viewMode === 'analysis' ? (\n                    // --- Analysis View (Charts) ---\n                    <div className=\"charts-grid\">\n                        {/* Коэффициент K */}\n                        <div className=\"k-coefficient-container\">\n                            <h3>Коэффициент динамики ККС</h3>\n                            <div className=\"k-value\">{kCoefficient}</div>\n                            <div className=\"k-description\">\n                                Коэффициент K показывает сумму приращений количества ДОК, полученных к каждому году в периоде оценки.\n                                Чем выше значение K, тем более прогрессивным является рост квалификации работника.\n                            </div>\n                        </div>\n\n                        {/* Conditional Rendering based on whether there are documents to display */}\n                         {(user.role !== 1 || selectedWorker !== null) && filteredDocuments.length > 0 ? (\n                             <>\n                                 {/* Yearly Chart */}\n                                 <div className=\"chart-wrapper\">\n                                      {yearlyChartResult.years.length > 0 ? (\n                                          <Bar options={yearlyOptions} data={yearlyData} />\n                                      ) : (\n                                          <p className=\"no-data-message\">Нет данных по годам.</p>\n                                      )}\n                                 </div>\n                                 {/* Cumulative Chart */}\n                                 <div className=\"chart-wrapper\">\n                                      {yearlyChartResult.years.length > 0 ? (\n                                          <Bar options={cumulativeOptions} data={cumulativeData} />\n                                      ) : (\n                                            <p className=\"no-data-message\">Нет данных по годам.</p> // Redundant but harmless\n                                      )}\n                                 </div>\n                                 {/* KKS Chart (Takes full width potentially on smaller screens, adjust CSS needed) */}\n                                 <div className=\"chart-wrapper kks-chart-wrapper\">\n                                     {/* Check if there are KKS labels to display */}\n                                      {kksChartResult.labels.length > 0 ? (\n                                          <Bar options={kksOptions} data={kksData} />\n                                      ) : (\n                                          <p className=\"no-data-message\">Нет данных по критериям ККС для отображения.</p>\n                                      )}\n                                 </div>\n                             </>\n                         ) : (\n                             // Message when no documents are available for the current view/filter\n                             <div className=\"no-data-message full-width-message\">\n                                 {user.role === 1 ?\n                                     (selectedWorker === null ? \"Пожалуйста, выберите работника для просмотра анализа.\" : `Нет документов для анализа у выбранного работника (${getWorkerName()}).`) :\n                                     \"У вас пока нет загруженных документов для анализа.\"\n                                 }\n                             </div>\n                         )}\n                    </div>\n                ) : (\n                    // --- Documents View (Table) ---\n                     <div className=\"documents-list\">\n                         {/* Conditional Rendering for the table */}\n                          {(user.role !== 1 || selectedWorker !== null) && filteredDocuments.length > 0 ? (\n                              <table className=\"documents-table\">\n                                  <thead>\n                                    <tr>\n                                        {/* Show Worker column only for Admin */}\n                                        {renderSortableHeader('Программа обучения', 'ProgramName')}\n                                        {renderSortableHeader('Организация', 'OrgSName')}\n                                        {renderSortableHeader('Рег. номер', 'regnumber')}\n                                        {renderSortableHeader('Дата выдачи', 'DateIssue')}\n                                        <th>Действия</th>\n                                    </tr>\n                                  </thead>\n                                  <tbody>\n                                      {filteredDocuments.map((doc) => (\n                                          <tr key={doc.ID_Document}>\n                                              {/* Document Details cells */}\n                                              <td>{doc.ProgramName || 'N/A'}</td>\n                                              <td>{doc.OrgSName || doc.OrgFName || 'N/A'}</td> {/* Display Short name, fallback to Full */}\n                                              <td>{doc.regnumber || 'N/A'}</td>\n                                              <td>{formatDate(doc.DateIssue)}</td> {/* Use formatted date */}\n                                              <td>\n                                                  {/* Button to open the modal */}\n                                                  <button\n                                                      className=\"details-button\"\n                                                      onClick={() => openModal(doc)} // Pass the whole document object\n                                                  >\n                                                      Дополнительно\n                                                  </button>\n                                              </td>\n                                          </tr>\n                                      ))}\n                                  </tbody>\n                              </table>\n                          ) : (\n                              // Message when no documents are available for the table view\n                              <div className=\"no-data-message full-width-message\">\n                                  {user.role === 1 ?\n                                      (selectedWorker === null ? \"Пожалуйста, выберите работника для просмотра списка документов.\" : `Нет документов для отображения у выбранного работника (${getWorkerName()}).`) :\n                                      \"У вас пока нет загруженных документов.\"\n                                  }\n                              </div>\n                          )}\n                     </div>\n                )}\n            </div>\n\n            {/* Modal Definition */}\n            <Modal\n                isOpen={isModalOpen}\n                onRequestClose={closeModal}\n                contentLabel=\"Детали документа\" // Accessibility label\n                className=\"modal-content\" // Class for styling the modal content\n                overlayClassName=\"modal-overlay\" // Class for styling the background overlay\n                ariaHideApp={true} // Helps with screen readers\n            >\n                {/* Content inside the modal */}\n                {selectedDocumentForModal ? (\n                    <>\n                        {/* Modal Header */}\n                        <h2>Детали документа № {selectedDocumentForModal.regnumber || selectedDocumentForModal.ID_Document}</h2>\n                        <button onClick={closeModal} className=\"modal-close-button\" aria-label=\"Закрыть\">&times;</button>\n\n                        {/* Modal Body with Details */}\n                        <div className=\"modal-details-grid\">\n                             {/* Display various document details */}\n                              <p><strong>Работник:</strong> {selectedDocumentForModal.WorkerName || getWorkerName() || 'N/A'}</p>\n                              <p><strong>Программа обучения:</strong> {selectedDocumentForModal.ProgramName || 'N/A'}</p>\n                              <p><strong>Организация (полное):</strong> {selectedDocumentForModal.OrgFName || 'N/A'}</p>\n                              <p><strong>Организация (краткое):</strong> {selectedDocumentForModal.OrgSName || 'N/A'}</p>\n                              <p><strong>Регистрационный номер:</strong> {selectedDocumentForModal.regnumber || 'N/A'}</p>\n                              <p><strong>Дата выдачи:</strong> {formatDate(selectedDocumentForModal.DateIssue)}</p>\n                              {/* Add any other relevant fields from your 'doc' object */}\n\n                              {/* Display KKS Criteria */}\n                             <p className=\"kks-details\">\n                                 <strong>Критерии ККС:</strong>\n                                 {/* Check if KKS_Data is an array and has items */}\n                                  {Array.isArray(selectedDocumentForModal.KKS_Data) && selectedDocumentForModal.KKS_Data.length > 0\n                                      ? selectedDocumentForModal.KKS_Data\n                                            .map(k => k.fullName || k.shortName) // Prefer full name, fallback to short\n                                            .filter(Boolean) // Remove any null/empty values\n                                            .join(', ') // Join with comma and space\n                                      : 'Нет данных'} {/* Message if no KKS data or not an array */}\n                             </p>\n                        </div>\n                    </>\n                ) : (\n                     // Fallback message if modal opens before data is ready (shouldn't usually happen)\n                    <p>Загрузка деталей...</p>\n                )}\n            </Modal>\n        </div>\n    );\n}\n\nexport default DocumentAnalysis;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}