{"ast":null,"code":"var _jsxFileName = \"D:\\\\Amina\\\\VScode\\\\FQW_new\\\\src\\\\components\\\\User.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport './User.css'; // Убедитесь, что стили подключены и обновлены\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst apiUrl = process.env.REACT_APP_API_URL;\n\n// --- Helper Functions (без изменений) ---\nconst isTrainingNeeded = lastTrainingDateStr => {\n  // ... (ваш существующий код)\n  if (!lastTrainingDateStr) {\n    return true; // No training date found, assume training is needed\n  }\n  try {\n    const lastTrainingDate = new Date(lastTrainingDateStr);\n    const threeYearsAgo = new Date();\n    threeYearsAgo.setFullYear(threeYearsAgo.getFullYear() - 3);\n    if (isNaN(lastTrainingDate.getTime())) {\n      console.warn(\"Invalid date encountered:\", lastTrainingDateStr);\n      return true; // Treat invalid date as needing training\n    }\n    return lastTrainingDate < threeYearsAgo;\n  } catch (e) {\n    console.error(\"Error parsing date:\", lastTrainingDateStr, e);\n    return true; // Error parsing date, assume training needed\n  }\n};\nconst formatDate = dateStr => {\n  // ... (ваш существующий код)\n  if (!dateStr) return 'Нет данных';\n  try {\n    const date = new Date(dateStr);\n    if (isNaN(date.getTime())) return 'Некорректная дата';\n    return date.toLocaleDateString('ru-RU'); // Format to DD.MM.YYYY\n  } catch (e) {\n    return 'Ошибка формата';\n  }\n};\n// --- ---\n\nfunction User() {\n  _s();\n  const navigate = useNavigate();\n  const [user, setUser] = useState(null);\n  const [kksStatus, setKksStatus] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // --- Новые состояния для рекомендаций по конкретному ККС ---\n  const [visibleRecommendationsKksId, setVisibleRecommendationsKksId] = useState(null); // ID ККС, чьи рекомендации показываем\n  const [currentRecommendations, setCurrentRecommendations] = useState([]); // Список программ для выбранного ККС\n  const [isCurrentRecLoading, setIsCurrentRecLoading] = useState(false); // Загрузка для выбранного ККС\n  const [currentRecError, setCurrentRecError] = useState(null); // Ошибка для выбранного ККС\n  // --- ---\n\n  // Эффект для загрузки данных пользователя (без изменений)\n  useEffect(() => {\n    const storedUser = localStorage.getItem('user');\n    if (storedUser) {\n      try {\n        const parsedUser = JSON.parse(storedUser);\n        if (!parsedUser.FName_Worker) {\n          console.warn(\"FName_Worker отсутствует в данных пользователя из localStorage.\");\n        }\n        setUser(parsedUser);\n      } catch (e) {\n        console.error(\"Ошибка парсинга пользователя из localStorage:\", e);\n        localStorage.removeItem('user');\n        setError(\"Ошибка данных пользователя. Пожалуйста, войдите снова.\");\n        setIsLoading(false);\n      }\n    } else {\n      setError(\"Пользователь не аутентифицирован.\");\n      setIsLoading(false);\n      // navigate('/login');\n    }\n  }, []);\n\n  // Эффект для загрузки ТОЛЬКО статуса ККС\n  useEffect(() => {\n    if (!user || !user.workerId) {\n      if (user === null && !isLoading) {\n        setError(\"Данные пользователя отсутствуют.\");\n      }\n      return;\n    }\n    if (user.role !== 0) {\n      console.log(\"Пользователь не является работником (role != 0), данные ККС не запрашиваются.\");\n      setKksStatus([]);\n      setIsLoading(false);\n      return;\n    }\n    const fetchKksStatus = async () => {\n      setIsLoading(true);\n      setError(null);\n      setKksStatus([]);\n      // Сбрасываем состояния рекомендаций при перезагрузке статуса\n      setVisibleRecommendationsKksId(null);\n      setCurrentRecommendations([]);\n      setIsCurrentRecLoading(false);\n      setCurrentRecError(null);\n      try {\n        console.log(`Workspaceing KKS status for workerId: ${user.workerId}`);\n        const kksResponse = await axios.get(`apiUrl/api/user-kks-status?userId=${user.workerId}`);\n        const fetchedKksStatus = kksResponse.data || [];\n        setKksStatus(fetchedKksStatus);\n        console.log(\"KKS Status Response:\", fetchedKksStatus);\n      } catch (kksErr) {\n        var _kksErr$response, _kksErr$response$data;\n        console.error('Ошибка при загрузке статуса ККС:', kksErr);\n        setError(((_kksErr$response = kksErr.response) === null || _kksErr$response === void 0 ? void 0 : (_kksErr$response$data = _kksErr$response.data) === null || _kksErr$response$data === void 0 ? void 0 : _kksErr$response$data.error) || 'Не удалось загрузить статус обучения по ККС.');\n        setKksStatus([]);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    fetchKksStatus();\n  }, [user]); // Зависимость только от user\n\n  // --- Обработчик для показа/скрытия и загрузки рекомендаций ---\n  const handleToggleRecommendations = useCallback(async kksId => {\n    // Если кликнули по той же кнопке, просто скрываем\n    if (visibleRecommendationsKksId === kksId) {\n      setVisibleRecommendationsKksId(null);\n      setCurrentRecommendations([]); // Очищаем список\n      return;\n    }\n\n    // Показываем лоадер и сбрасываем предыдущие данные/ошибки\n    setVisibleRecommendationsKksId(kksId);\n    setIsCurrentRecLoading(true);\n    setCurrentRecommendations([]);\n    setCurrentRecError(null);\n    try {\n      console.log(`Workspaceing recommended programs for KKS ID: ${kksId}`);\n      // Запрос ТОЛЬКО для ОДНОГО kksId\n      const recResponse = await axios.get(`${apiUrl}/api/programs/recommended?kksIds=${kksId}`);\n      console.log(\"Recommended Programs Response for KKS\", kksId, \":\", recResponse.data);\n      setCurrentRecommendations(recResponse.data || []);\n    } catch (recErr) {\n      var _recErr$response, _recErr$response$data;\n      console.error(`Ошибка при загрузке рекомендуемых программ для KKS ${kksId}:`, recErr);\n      setCurrentRecError(((_recErr$response = recErr.response) === null || _recErr$response === void 0 ? void 0 : (_recErr$response$data = _recErr$response.data) === null || _recErr$response$data === void 0 ? void 0 : _recErr$response$data.error) || 'Не удалось загрузить рекомендуемые программы.');\n      setCurrentRecommendations([]); // Убедимся, что пусто при ошибке\n    } finally {\n      setIsCurrentRecLoading(false); // Загрузка завершена (успех/ошибка)\n    }\n  }, [visibleRecommendationsKksId, apiUrl]); // Зависим от visibleRecommendationsKksId для логики скрытия\n  // --- ---\n\n  // Обработчики навигации и выхода (без изменений)\n  const handleLogout = () => {\n    localStorage.removeItem('user');\n    setUser(null);\n    navigate('/login');\n  };\n  const handleViewDocuments = () => {\n    navigate('/documents');\n  };\n  const handleViewAnalysis = () => {\n    navigate('/analysis');\n  };\n\n  // --- Рендеринг ---\n\n  if (isLoading && !user) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading\",\n      children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 16\n    }, this);\n  }\n  if (error && !isLoading && !user) {\n    // Показываем общую ошибку, если нет пользователя\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 49\n      }, this), \" \", /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate('/login'),\n        children: \"\\u0412\\u043E\\u0439\\u0442\\u0438\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 86\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 16\n    }, this);\n  }\n  if (!user) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error\",\n        children: \"\\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435 \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044F.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 49\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate('/login'),\n        children: \"\\u0412\\u043E\\u0439\\u0442\\u0438\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 119\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 16\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"user-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"user-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"\\u041B\\u0438\\u0447\\u043D\\u044B\\u0439 \\u043A\\u0430\\u0431\\u0438\\u043D\\u0435\\u0442\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleLogout,\n        className: \"logout-button\",\n        children: \"\\u0412\\u044B\\u0439\\u0442\\u0438\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"user-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"user-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"\\u0418\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044F \\u043E \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0435\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u0424\\u0418\\u041E: \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 24\n          }, this), \" \", (user === null || user === void 0 ? void 0 : user.FName_Worker) || 'Имя не найдено']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u041B\\u043E\\u0433\\u0438\\u043D:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 24\n          }, this), \" \", (user === null || user === void 0 ? void 0 : user.login) || 'Логин не найден']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"\\u0420\\u043E\\u043B\\u044C:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 24\n          }, this), \" \", (user === null || user === void 0 ? void 0 : user.role) === 0 ? 'Работник ОУ' : (user === null || user === void 0 ? void 0 : user.role) === 1 ? 'Работник ЦДО (Админ)' : 'Неизвестная роль']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 17\n      }, this), (user === null || user === void 0 ? void 0 : user.role) === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"user-kks-status-table\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441 \\u043E\\u0431\\u0443\\u0447\\u0435\\u043D\\u0438\\u044F \\u043F\\u043E \\u041A\\u041A\\u0421\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 25\n        }, this), isLoading && /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441\\u0430 \\u041A\\u041A\\u0421...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 39\n        }, this), error && !isLoading && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"error-message\",\n          children: [\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0438 \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441\\u0430 \\u041A\\u041A\\u0421: \", error]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 49\n        }, this), !isLoading && !error && kksStatus.length > 0 && /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"kks-table\",\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"\\u041A\\u0440\\u0438\\u0442\\u0435\\u0440\\u0438\\u0439 \\u041A\\u041A\\u0421\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 212,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 213,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u0435 / \\u0414\\u0430\\u0442\\u0430\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 214,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: kksStatus.map(kks => {\n              const needsTraining = isTrainingNeeded(kks.LastTrainingDate);\n              const isVisible = visibleRecommendationsKksId === kks.ID_KKS;\n              return /*#__PURE__*/_jsxDEV(React.Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                    children: [kks.KKS_FullName, \" (\", kks.KKS_ShortName, \")\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 225,\n                    columnNumber: 53\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    className: `status ${needsTraining ? 'status-needed' : 'status-ok'}`,\n                    children: needsTraining ? '✕' : '✓'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 226,\n                    columnNumber: 53\n                  }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: [\"\\u041F\\u043E\\u0441\\u043B\\u0435\\u0434\\u043D\\u0435\\u0435 \\u043E\\u0431\\u0443\\u0447\\u0435\\u043D\\u0438\\u0435: \", formatDate(kks.LastTrainingDate)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 231,\n                      columnNumber: 57\n                    }, this), needsTraining && /*#__PURE__*/_jsxDEV(\"div\", {\n                      style: {\n                        marginTop: '5px'\n                      },\n                      children: [\" \", /*#__PURE__*/_jsxDEV(\"button\", {\n                        onClick: () => handleToggleRecommendations(kks.ID_KKS),\n                        className: \"recommendation-toggle-button\",\n                        disabled: isCurrentRecLoading && isVisible // Блокируем кнопку во время загрузки для этого ККС\n                        ,\n                        children: [isVisible ? 'Скрыть программы' : 'Показать программы', isCurrentRecLoading && isVisible && '...']\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 238,\n                        columnNumber: 65\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 237,\n                      columnNumber: 61\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 229,\n                    columnNumber: 53\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 224,\n                  columnNumber: 49\n                }, this), isVisible && /*#__PURE__*/_jsxDEV(\"tr\", {\n                  className: \"recommendations-row\",\n                  children: /*#__PURE__*/_jsxDEV(\"td\", {\n                    colSpan: \"3\",\n                    children: /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"recommendations-details\",\n                      children: [isCurrentRecLoading && /*#__PURE__*/_jsxDEV(\"p\", {\n                        children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0440\\u0435\\u043A\\u043E\\u043C\\u0435\\u043D\\u0434\\u0443\\u0435\\u043C\\u044B\\u0445 \\u043F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u043C...\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 258,\n                        columnNumber: 89\n                      }, this), currentRecError && /*#__PURE__*/_jsxDEV(\"p\", {\n                        className: \"error-message\",\n                        children: [\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \", currentRecError]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 259,\n                        columnNumber: 85\n                      }, this), !isCurrentRecLoading && !currentRecError && /*#__PURE__*/_jsxDEV(_Fragment, {\n                        children: currentRecommendations.length > 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                            children: \"\\u0420\\u0435\\u043A\\u043E\\u043C\\u0435\\u043D\\u0434\\u0443\\u0435\\u043C\\u044B\\u0435 \\u043F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u043C\\u044B \\u0414\\u041F\\u041E:\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 264,\n                            columnNumber: 81\n                          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n                            children: currentRecommendations.map(program => /*#__PURE__*/_jsxDEV(\"li\", {\n                              className: \"program-item\",\n                              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                                children: program.Name_ProgDPO\n                              }, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 268,\n                                columnNumber: 93\n                              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                                fileName: _jsxFileName,\n                                lineNumber: 269,\n                                columnNumber: 93\n                              }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                                children: [\"\\u041E\\u0440\\u0433\\u0430\\u043D\\u0438\\u0437\\u0430\\u0446\\u0438\\u044F: \", program.OrgSName || program.OrgFName || 'Не указана', ' | ', \"\\u0422\\u0438\\u043F: \", program.Name_Type || 'Не указан']\n                              }, void 0, true, {\n                                fileName: _jsxFileName,\n                                lineNumber: 270,\n                                columnNumber: 93\n                              }, this)]\n                            }, program.ID_ProgDPO, true, {\n                              fileName: _jsxFileName,\n                              lineNumber: 267,\n                              columnNumber: 89\n                            }, this))\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 265,\n                            columnNumber: 81\n                          }, this)]\n                        }, void 0, true) : /*#__PURE__*/_jsxDEV(\"p\", {\n                          children: \"\\u041F\\u043E\\u0434\\u0445\\u043E\\u0434\\u044F\\u0449\\u0438\\u0445 \\u043F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u043C \\u0414\\u041F\\u041E \\u0434\\u043B\\u044F \\u0434\\u0430\\u043D\\u043D\\u043E\\u0433\\u043E \\u041A\\u041A\\u0421 \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E.\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 280,\n                          columnNumber: 77\n                        }, this)\n                      }, void 0, false)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 257,\n                      columnNumber: 61\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 256,\n                    columnNumber: 57\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 254,\n                  columnNumber: 53\n                }, this)]\n              }, kks.ID_KKS, true, {\n                fileName: _jsxFileName,\n                lineNumber: 223,\n                columnNumber: 45\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 29\n        }, this), !isLoading && !error && kksStatus.length === 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"\\u041D\\u0435\\u0442 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 \\u043E \\u043F\\u0440\\u043E\\u0445\\u043E\\u0436\\u0434\\u0435\\u043D\\u0438\\u0438 \\u043E\\u0431\\u0443\\u0447\\u0435\\u043D\\u0438\\u044F \\u043F\\u043E \\u041A\\u041A\\u0421.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"user-actions\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleViewDocuments,\n          className: \"action-button\",\n          children: \"\\u041F\\u0440\\u043E\\u0441\\u043C\\u043E\\u0442\\u0440 \\u041C\\u043E\\u0438\\u0445 \\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u043E\\u0432\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleViewAnalysis,\n          className: \"action-button\",\n          children: \"\\u041F\\u0440\\u043E\\u0441\\u043C\\u043E\\u0442\\u0440 \\u0410\\u043D\\u0430\\u043B\\u0438\\u0437\\u0430\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 185,\n    columnNumber: 9\n  }, this);\n}\n_s(User, \"vMpFaPPYGDRTyCS1jKH7E+Xu5Ik=\", false, function () {\n  return [useNavigate];\n});\n_c = User;\nexport default User;\nvar _c;\n$RefreshReg$(_c, \"User\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useMemo","useNavigate","axios","jsxDEV","_jsxDEV","Fragment","_Fragment","apiUrl","process","env","REACT_APP_API_URL","isTrainingNeeded","lastTrainingDateStr","lastTrainingDate","Date","threeYearsAgo","setFullYear","getFullYear","isNaN","getTime","console","warn","e","error","formatDate","dateStr","date","toLocaleDateString","User","_s","navigate","user","setUser","kksStatus","setKksStatus","isLoading","setIsLoading","setError","visibleRecommendationsKksId","setVisibleRecommendationsKksId","currentRecommendations","setCurrentRecommendations","isCurrentRecLoading","setIsCurrentRecLoading","currentRecError","setCurrentRecError","storedUser","localStorage","getItem","parsedUser","JSON","parse","FName_Worker","removeItem","workerId","role","log","fetchKksStatus","kksResponse","get","fetchedKksStatus","data","kksErr","_kksErr$response","_kksErr$response$data","response","handleToggleRecommendations","kksId","recResponse","recErr","_recErr$response","_recErr$response$data","handleLogout","handleViewDocuments","handleViewAnalysis","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","login","length","map","kks","needsTraining","LastTrainingDate","isVisible","ID_KKS","KKS_FullName","KKS_ShortName","style","marginTop","disabled","colSpan","program","Name_ProgDPO","OrgSName","OrgFName","Name_Type","ID_ProgDPO","_c","$RefreshReg$"],"sources":["D:/Amina/VScode/FQW_new/src/components/User.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport './User.css'; // Убедитесь, что стили подключены и обновлены\n\nconst apiUrl = process.env.REACT_APP_API_URL;\n\n// --- Helper Functions (без изменений) ---\nconst isTrainingNeeded = (lastTrainingDateStr) => {\n    // ... (ваш существующий код)\n     if (!lastTrainingDateStr) {\n         return true; // No training date found, assume training is needed\n     }\n     try {\n         const lastTrainingDate = new Date(lastTrainingDateStr);\n         const threeYearsAgo = new Date();\n         threeYearsAgo.setFullYear(threeYearsAgo.getFullYear() - 3);\n\n         if (isNaN(lastTrainingDate.getTime())) {\n             console.warn(\"Invalid date encountered:\", lastTrainingDateStr);\n             return true; // Treat invalid date as needing training\n         }\n\n         return lastTrainingDate < threeYearsAgo;\n     } catch (e) {\n         console.error(\"Error parsing date:\", lastTrainingDateStr, e);\n         return true; // Error parsing date, assume training needed\n     }\n};\n\nconst formatDate = (dateStr) => {\n    // ... (ваш существующий код)\n    if (!dateStr) return 'Нет данных';\n    try {\n        const date = new Date(dateStr);\n        if (isNaN(date.getTime())) return 'Некорректная дата';\n        return date.toLocaleDateString('ru-RU'); // Format to DD.MM.YYYY\n    } catch (e) {\n        return 'Ошибка формата';\n    }\n};\n// --- ---\n\nfunction User() {\n    const navigate = useNavigate();\n    const [user, setUser] = useState(null);\n    const [kksStatus, setKksStatus] = useState([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    // --- Новые состояния для рекомендаций по конкретному ККС ---\n    const [visibleRecommendationsKksId, setVisibleRecommendationsKksId] = useState(null); // ID ККС, чьи рекомендации показываем\n    const [currentRecommendations, setCurrentRecommendations] = useState([]); // Список программ для выбранного ККС\n    const [isCurrentRecLoading, setIsCurrentRecLoading] = useState(false); // Загрузка для выбранного ККС\n    const [currentRecError, setCurrentRecError] = useState(null); // Ошибка для выбранного ККС\n    // --- ---\n\n    // Эффект для загрузки данных пользователя (без изменений)\n    useEffect(() => {\n        const storedUser = localStorage.getItem('user');\n        if (storedUser) {\n            try {\n                const parsedUser = JSON.parse(storedUser);\n                if (!parsedUser.FName_Worker) {\n                   console.warn(\"FName_Worker отсутствует в данных пользователя из localStorage.\");\n                }\n                setUser(parsedUser);\n            } catch (e) {\n                console.error(\"Ошибка парсинга пользователя из localStorage:\", e);\n                localStorage.removeItem('user');\n                setError(\"Ошибка данных пользователя. Пожалуйста, войдите снова.\");\n                setIsLoading(false);\n            }\n        } else {\n            setError(\"Пользователь не аутентифицирован.\");\n            setIsLoading(false);\n            // navigate('/login');\n        }\n    }, []);\n\n    // Эффект для загрузки ТОЛЬКО статуса ККС\n    useEffect(() => {\n        if (!user || !user.workerId) {\n            if (user === null && !isLoading) {\n                setError(\"Данные пользователя отсутствуют.\");\n            }\n            return;\n        }\n\n        if (user.role !== 0) {\n            console.log(\"Пользователь не является работником (role != 0), данные ККС не запрашиваются.\");\n            setKksStatus([]);\n            setIsLoading(false);\n            return;\n        }\n\n        const fetchKksStatus = async () => {\n            setIsLoading(true);\n            setError(null);\n            setKksStatus([]);\n            // Сбрасываем состояния рекомендаций при перезагрузке статуса\n            setVisibleRecommendationsKksId(null);\n            setCurrentRecommendations([]);\n            setIsCurrentRecLoading(false);\n            setCurrentRecError(null);\n\n            try {\n                console.log(`Workspaceing KKS status for workerId: ${user.workerId}`);\n                const kksResponse = await axios.get(`apiUrl/api/user-kks-status?userId=${user.workerId}`);\n                const fetchedKksStatus = kksResponse.data || [];\n                setKksStatus(fetchedKksStatus);\n                console.log(\"KKS Status Response:\", fetchedKksStatus);\n            } catch (kksErr) {\n                console.error('Ошибка при загрузке статуса ККС:', kksErr);\n                setError(kksErr.response?.data?.error || 'Не удалось загрузить статус обучения по ККС.');\n                setKksStatus([]);\n            } finally {\n                setIsLoading(false);\n            }\n        };\n\n        fetchKksStatus();\n\n    }, [user]); // Зависимость только от user\n\n    // --- Обработчик для показа/скрытия и загрузки рекомендаций ---\n    const handleToggleRecommendations = useCallback(async (kksId) => {\n        // Если кликнули по той же кнопке, просто скрываем\n        if (visibleRecommendationsKksId === kksId) {\n            setVisibleRecommendationsKksId(null);\n            setCurrentRecommendations([]); // Очищаем список\n            return;\n        }\n\n        // Показываем лоадер и сбрасываем предыдущие данные/ошибки\n        setVisibleRecommendationsKksId(kksId);\n        setIsCurrentRecLoading(true);\n        setCurrentRecommendations([]);\n        setCurrentRecError(null);\n\n        try {\n            console.log(`Workspaceing recommended programs for KKS ID: ${kksId}`);\n            // Запрос ТОЛЬКО для ОДНОГО kksId\n            const recResponse = await axios.get(`${apiUrl}/api/programs/recommended?kksIds=${kksId}`);\n            console.log(\"Recommended Programs Response for KKS\", kksId, \":\", recResponse.data);\n            setCurrentRecommendations(recResponse.data || []);\n        } catch (recErr) {\n            console.error(`Ошибка при загрузке рекомендуемых программ для KKS ${kksId}:`, recErr);\n            setCurrentRecError(recErr.response?.data?.error || 'Не удалось загрузить рекомендуемые программы.');\n            setCurrentRecommendations([]); // Убедимся, что пусто при ошибке\n        } finally {\n            setIsCurrentRecLoading(false); // Загрузка завершена (успех/ошибка)\n        }\n    }, [visibleRecommendationsKksId, apiUrl]); // Зависим от visibleRecommendationsKksId для логики скрытия\n    // --- ---\n\n    // Обработчики навигации и выхода (без изменений)\n    const handleLogout = () => {\n        localStorage.removeItem('user');\n        setUser(null);\n        navigate('/login');\n    };\n\n    const handleViewDocuments = () => {\n        navigate('/documents');\n    };\n\n    const handleViewAnalysis = () => {\n        navigate('/analysis');\n    };\n\n    // --- Рендеринг ---\n\n    if (isLoading && !user) {\n        return <div className=\"loading\">Загрузка данных пользователя...</div>;\n    }\n    if (error && !isLoading && !user) { // Показываем общую ошибку, если нет пользователя\n        return <div className=\"error-container\"><div className=\"error\">{error}</div> <button onClick={() => navigate('/login')}>Войти</button></div>;\n    }\n    if (!user) {\n        return <div className=\"error-container\"><div className=\"error\">Не удалось загрузить данные пользователя.</div><button onClick={() => navigate('/login')}>Войти</button></div>;\n    }\n\n    return (\n        <div className=\"user-container\">\n            <div className=\"user-header\">\n                <h1>Личный кабинет</h1>\n                <button onClick={handleLogout} className=\"logout-button\">Выйти</button>\n            </div>\n\n            <div className=\"user-content\">\n                {/* Информация о пользователе (без изменений) */}\n                <div className=\"user-info\">\n                    <h2>Информация о пользователе</h2>\n                    <p><strong>ФИО: </strong> {user?.FName_Worker || 'Имя не найдено'}</p>\n                    <p><strong>Логин:</strong> {user?.login || 'Логин не найден'}</p>\n                    <p><strong>Роль:</strong> {user?.role === 0 ? 'Работник ОУ' : user?.role === 1 ? 'Работник ЦДО (Админ)' : 'Неизвестная роль'}</p>\n                </div>\n\n                {/* Статус обучения по ККС (только для работников) - ТАБЛИЦА */}\n                {user?.role === 0 && (\n                    <div className=\"user-kks-status-table\">\n                        <h2>Статус обучения по ККС</h2>\n                        {isLoading && <p>Загрузка статуса ККС...</p>}\n                        {/* Показываем ошибку загрузки ККС, если она не связана с отсутствием пользователя */}\n                        {error && !isLoading && <p className=\"error-message\">Ошибка загрузки статуса ККС: {error}</p>}\n\n                        {!isLoading && !error && kksStatus.length > 0 && (\n                            <table className=\"kks-table\">\n                                <thead>\n                                    <tr>\n                                        <th>Критерий ККС</th>\n                                        <th>Статус</th>\n                                        <th>Действие / Дата</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    {kksStatus.map((kks) => {\n                                        const needsTraining = isTrainingNeeded(kks.LastTrainingDate);\n                                        const isVisible = visibleRecommendationsKksId === kks.ID_KKS;\n\n                                        return (\n                                            <React.Fragment key={kks.ID_KKS}>\n                                                <tr>\n                                                    <td>{kks.KKS_FullName} ({kks.KKS_ShortName})</td>\n                                                    <td className={`status ${needsTraining ? 'status-needed' : 'status-ok'}`}>\n                                                        {needsTraining ? '✕' : '✓'}\n                                                    </td>\n                                                    <td>\n                                                        {/* Всегда отображаем дату */}\n                                                        <span>\n                                                            Последнее обучение: {formatDate(kks.LastTrainingDate)}\n                                                        </span>\n\n                                                        {/* Если обучение требуется (needsTraining === true), ДОПОЛНИТЕЛЬНО показываем кнопку ниже */}\n                                                        {needsTraining && (\n                                                            <div style={{ marginTop: '5px' }}> {/* Добавляем небольшой отступ сверху для кнопки */}\n                                                                <button\n                                                                    onClick={() => handleToggleRecommendations(kks.ID_KKS)}\n                                                                    className=\"recommendation-toggle-button\"\n                                                                    disabled={isCurrentRecLoading && isVisible} // Блокируем кнопку во время загрузки для этого ККС\n                                                                >\n                                                                    {/* Меняем текст кнопки в зависимости от состояния */}\n                                                                    {isVisible ? 'Скрыть программы' : 'Показать программы'}\n                                                                    {/* Можно добавить спиннер */}\n                                                                    {isCurrentRecLoading && isVisible && '...'}\n                                                                </button>\n                                                            </div>\n                                                        )}\n                                                    </td>\n                                                </tr>\n                                                {/* --- Условный рендеринг рекомендаций ПОД строкой --- */}\n                                                {isVisible && (\n                                                    <tr className=\"recommendations-row\">\n                                                        {/* Объединяем ячейки для отображения рекомендаций */}\n                                                        <td colSpan=\"3\">\n                                                            <div className=\"recommendations-details\">\n                                                                {isCurrentRecLoading && <p>Загрузка рекомендуемых программ...</p>}\n                                                                {currentRecError && <p className=\"error-message\">Ошибка: {currentRecError}</p>}\n                                                                {!isCurrentRecLoading && !currentRecError && (\n                                                                    <>\n                                                                        {currentRecommendations.length > 0 ? (\n                                                                            <>\n                                                                                <h4>Рекомендуемые программы ДПО:</h4>\n                                                                                <ul>\n                                                                                    {currentRecommendations.map(program => (\n                                                                                        <li key={program.ID_ProgDPO} className=\"program-item\">\n                                                                                            <strong>{program.Name_ProgDPO}</strong>\n                                                                                            <br />\n                                                                                            <small>\n                                                                                                Организация: {program.OrgSName || program.OrgFName || 'Не указана'}\n                                                                                                {' | '}\n                                                                                                Тип: {program.Name_Type || 'Не указан'}\n                                                                                            </small>\n                                                                                        </li>\n                                                                                    ))}\n                                                                                </ul>\n                                                                            </>\n                                                                        ) : (\n                                                                            <p>Подходящих программ ДПО для данного ККС не найдено.</p>\n                                                                        )}\n                                                                    </>\n                                                                )}\n                                                            </div>\n                                                        </td>\n                                                    </tr>\n                                                )}\n                                                {/* --- --- */}\n                                            </React.Fragment>\n                                        );\n                                    })}\n                                </tbody>\n                            </table>\n                        )}\n                        {/* Сообщение, если ККС вообще нет */}\n                        {!isLoading && !error && kksStatus.length === 0 && (\n                            <p>Нет данных о прохождении обучения по ККС.</p>\n                        )}\n                    </div>\n                )}\n\n                {/* Убираем старые блоки уведомлений и рекомендаций */}\n                {/* {user?.role === 0 && kksNeedingTraining.length > 0 && (...) } */}\n                {/* {user?.role === 0 && (...) } */}\n\n                {/* Кнопки действий (без изменений) */}\n                <div className=\"user-actions\">\n                    <button onClick={handleViewDocuments} className=\"action-button\">\n                        Просмотр Моих Документов\n                    </button>\n                    <button onClick={handleViewAnalysis} className=\"action-button\">\n                        Просмотр Анализа\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n\nexport default User;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}