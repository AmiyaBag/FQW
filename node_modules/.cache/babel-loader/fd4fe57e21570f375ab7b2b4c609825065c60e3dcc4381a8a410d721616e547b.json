{"ast":null,"code":"var _jsxFileName = \"D:\\\\Amina\\\\VScode\\\\FQW_new\\\\src\\\\components\\\\DocumentAnalysis.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport Modal from 'react-modal';\nimport { Chart as ChartJS, CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend } from 'chart.js';\nimport { Bar } from 'react-chartjs-2';\nimport './DocumentAnalysis.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst apiUrl = process.env.REACT_APP_API_URL;\nModal.setAppElement('#root');\nChartJS.register(CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend);\nfunction DocumentAnalysis() {\n  _s();\n  // State Variables\n  const [documents, setDocuments] = useState([]);\n  const [workers, setWorkers] = useState([]);\n  const [selectedWorker, setSelectedWorker] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [viewMode, setViewMode] = useState('analysis');\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [selectedDocumentForModal, setSelectedDocumentForModal] = useState(null);\n  const [sortConfig, setSortConfig] = useState({\n    key: 'DateIssue',\n    direction: 'descending'\n  }); // Added sort state\n\n  // Hooks\n  const navigate = useNavigate();\n  const user = JSON.parse(localStorage.getItem('user'));\n\n  // Sort function\n  const requestSort = key => {\n    let direction = 'ascending';\n    if (sortConfig.key === key && sortConfig.direction === 'ascending') {\n      direction = 'descending';\n    }\n    setSortConfig({\n      key,\n      direction\n    });\n  };\n\n  // Helper function to sort documents\n  const sortDocuments = (docs, config) => {\n    if (!config.key) return docs;\n    return [...docs].sort((a, b) => {\n      // Handle date fields specially\n      if (['DateIssue', 'DataStart', 'DataEnd'].includes(config.key)) {\n        const dateA = a[config.key] ? new Date(a[config.key]).getTime() : 0;\n        const dateB = b[config.key] ? new Date(b[config.key]).getTime() : 0;\n        if (dateA < dateB) {\n          return config.direction === 'ascending' ? -1 : 1;\n        }\n        if (dateA > dateB) {\n          return config.direction === 'ascending' ? 1 : -1;\n        }\n        return 0;\n      }\n\n      // Handle numeric fields\n      if (['ID_Document', 'ID_Worker', 'ID_ProgDPO'].includes(config.key)) {\n        const valA = a[config.key] || 0;\n        const valB = b[config.key] || 0;\n        return config.direction === 'ascending' ? valA - valB : valB - valA;\n      }\n\n      // Handle string fields\n      const valA = String(a[config.key] || '').toLowerCase();\n      const valB = String(b[config.key] || '').toLowerCase();\n      if (valA < valB) {\n        return config.direction === 'ascending' ? -1 : 1;\n      }\n      if (valA > valB) {\n        return config.direction === 'ascending' ? 1 : -1;\n      }\n      return 0;\n    });\n  };\n\n  // Render sortable header\n  const renderSortableHeader = (label, key) => /*#__PURE__*/_jsxDEV(\"th\", {\n    onClick: () => requestSort(key),\n    className: \"sortable-header\",\n    style: {\n      cursor: 'pointer'\n    },\n    children: [label, sortConfig.key === key ? sortConfig.direction === 'ascending' ? ' ▲' : ' ▼' : ' ↕']\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 9\n  }, this);\n\n  // --- Rest of the existing code remains the same until filteredDocuments ---\n\n  // Update filteredDocuments to include sorting\n  const filteredDocuments = useMemo(() => {\n    if (loading || !Array.isArray(documents)) return [];\n    let filtered = documents;\n    if ((user === null || user === void 0 ? void 0 : user.role) === 1) {\n      filtered = selectedWorker !== null ? documents.filter(doc => doc.ID_Worker === selectedWorker) : [];\n    }\n    return sortDocuments(filtered, sortConfig);\n  }, [documents, selectedWorker, user === null || user === void 0 ? void 0 : user.role, loading, sortConfig]);\n\n  // --- Rest of the component remains the same ---\n\n  // Update the documents table header to use sortable headers\n  // In the render section, replace the table header with:\n  /*#__PURE__*/_jsxDEV(\"thead\", {\n    children: /*#__PURE__*/_jsxDEV(\"tr\", {\n      children: [(user === null || user === void 0 ? void 0 : user.role) === 1 && /*#__PURE__*/_jsxDEV(\"th\", {\n        children: \"\\u0420\\u0430\\u0431\\u043E\\u0442\\u043D\\u0438\\u043A\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 34\n      }, this), renderSortableHeader('Программа обучения', 'ProgramName'), renderSortableHeader('Организация (Кратко)', 'OrgSName'), renderSortableHeader('Рег. номер', 'regnumber'), renderSortableHeader('Дата выдачи', 'DateIssue'), /*#__PURE__*/_jsxDEV(\"th\", {\n        children: \"\\u0414\\u0435\\u0439\\u0441\\u0442\\u0432\\u0438\\u044F\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 127,\n    columnNumber: 5\n  }, this);\n\n  // --- Rest of the component remains unchanged ---\n}\n_s(DocumentAnalysis, \"wzZTimQ4HJsCQLKaihjMu6pi+8c=\", false, function () {\n  return [useNavigate];\n});\n_c = DocumentAnalysis;\nexport default DocumentAnalysis;\nvar _c;\n$RefreshReg$(_c, \"DocumentAnalysis\");","map":{"version":3,"names":["React","useState","useEffect","useMemo","useCallback","axios","useNavigate","Modal","Chart","ChartJS","CategoryScale","LinearScale","BarElement","Title","Tooltip","Legend","Bar","jsxDEV","_jsxDEV","apiUrl","process","env","REACT_APP_API_URL","setAppElement","register","DocumentAnalysis","_s","documents","setDocuments","workers","setWorkers","selectedWorker","setSelectedWorker","loading","setLoading","error","setError","viewMode","setViewMode","isModalOpen","setIsModalOpen","selectedDocumentForModal","setSelectedDocumentForModal","sortConfig","setSortConfig","key","direction","navigate","user","JSON","parse","localStorage","getItem","requestSort","sortDocuments","docs","config","sort","a","b","includes","dateA","Date","getTime","dateB","valA","valB","String","toLowerCase","renderSortableHeader","label","onClick","className","style","cursor","children","fileName","_jsxFileName","lineNumber","columnNumber","filteredDocuments","Array","isArray","filtered","role","filter","doc","ID_Worker","_c","$RefreshReg$"],"sources":["D:/Amina/VScode/FQW_new/src/components/DocumentAnalysis.js"],"sourcesContent":["import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport Modal from 'react-modal';\nimport {\n    Chart as ChartJS,\n    CategoryScale,\n    LinearScale,\n    BarElement,\n    Title,\n    Tooltip,\n    Legend\n} from 'chart.js';\nimport { Bar } from 'react-chartjs-2';\nimport './DocumentAnalysis.css';\n\nconst apiUrl = process.env.REACT_APP_API_URL;\n\nModal.setAppElement('#root');\n\nChartJS.register(\n    CategoryScale,\n    LinearScale,\n    BarElement,\n    Title,\n    Tooltip,\n    Legend\n);\n\nfunction DocumentAnalysis() {\n    // State Variables\n    const [documents, setDocuments] = useState([]);\n    const [workers, setWorkers] = useState([]);\n    const [selectedWorker, setSelectedWorker] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState('');\n    const [viewMode, setViewMode] = useState('analysis');\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [selectedDocumentForModal, setSelectedDocumentForModal] = useState(null);\n    const [sortConfig, setSortConfig] = useState({ key: 'DateIssue', direction: 'descending' }); // Added sort state\n\n    // Hooks\n    const navigate = useNavigate();\n    const user = JSON.parse(localStorage.getItem('user'));\n\n    // Sort function\n    const requestSort = (key) => {\n        let direction = 'ascending';\n        if (sortConfig.key === key && sortConfig.direction === 'ascending') {\n            direction = 'descending';\n        }\n        setSortConfig({ key, direction });\n    };\n\n    // Helper function to sort documents\n    const sortDocuments = (docs, config) => {\n        if (!config.key) return docs;\n        \n        return [...docs].sort((a, b) => {\n            // Handle date fields specially\n            if (['DateIssue', 'DataStart', 'DataEnd'].includes(config.key)) {\n                const dateA = a[config.key] ? new Date(a[config.key]).getTime() : 0;\n                const dateB = b[config.key] ? new Date(b[config.key]).getTime() : 0;\n                if (dateA < dateB) {\n                    return config.direction === 'ascending' ? -1 : 1;\n                }\n                if (dateA > dateB) {\n                    return config.direction === 'ascending' ? 1 : -1;\n                }\n                return 0;\n            }\n            \n            // Handle numeric fields\n            if (['ID_Document', 'ID_Worker', 'ID_ProgDPO'].includes(config.key)) {\n                const valA = a[config.key] || 0;\n                const valB = b[config.key] || 0;\n                return config.direction === 'ascending' ? valA - valB : valB - valA;\n            }\n            \n            // Handle string fields\n            const valA = String(a[config.key] || '').toLowerCase();\n            const valB = String(b[config.key] || '').toLowerCase();\n            if (valA < valB) {\n                return config.direction === 'ascending' ? -1 : 1;\n            }\n            if (valA > valB) {\n                return config.direction === 'ascending' ? 1 : -1;\n            }\n            return 0;\n        });\n    };\n\n    // Render sortable header\n    const renderSortableHeader = (label, key) => (\n        <th \n            onClick={() => requestSort(key)} \n            className=\"sortable-header\"\n            style={{ cursor: 'pointer' }}\n        >\n            {label} \n            {sortConfig.key === key ? (\n                sortConfig.direction === 'ascending' ? ' ▲' : ' ▼'\n            ) : ' ↕'}\n        </th>\n    );\n\n    // --- Rest of the existing code remains the same until filteredDocuments ---\n\n    // Update filteredDocuments to include sorting\n    const filteredDocuments = useMemo(() => {\n        if (loading || !Array.isArray(documents)) return [];\n        \n        let filtered = documents;\n        if (user?.role === 1) {\n            filtered = selectedWorker !== null\n                ? documents.filter(doc => doc.ID_Worker === selectedWorker)\n                : [];\n        }\n        \n        return sortDocuments(filtered, sortConfig);\n    }, [documents, selectedWorker, user?.role, loading, sortConfig]);\n\n    // --- Rest of the component remains the same ---\n\n    // Update the documents table header to use sortable headers\n    // In the render section, replace the table header with:\n    <thead>\n        <tr>\n            {user?.role === 1 && <th>Работник</th>}\n            {renderSortableHeader('Программа обучения', 'ProgramName')}\n            {renderSortableHeader('Организация (Кратко)', 'OrgSName')}\n            {renderSortableHeader('Рег. номер', 'regnumber')}\n            {renderSortableHeader('Дата выдачи', 'DateIssue')}\n            <th>Действия</th>\n        </tr>\n    </thead>\n\n    // --- Rest of the component remains unchanged ---\n}\n\nexport default DocumentAnalysis;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}